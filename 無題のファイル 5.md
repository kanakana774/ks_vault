Serviceå±¤ã§ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸä¾‹å¤–ã¯ã€æœ€çµ‚çš„ã«Spring Bootã®BasicErrorControllerï¼ˆã¾ãŸã¯ãã‚Œã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ï¼‰ã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã‚‹ã¾ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæµã‚Œã‚’ãŸã©ã‚Šã¾ã™ã€‚

ğŸ¯ Serviceå±¤ã®ä¾‹å¤–ãŒã‚­ãƒ£ãƒƒãƒã•ã‚Œã‚‹æµã‚Œ

Â * Serviceå±¤ã§ä¾‹å¤–ç™ºç”Ÿ:

Â  Â ã‚ãªãŸã®@Serviceã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ä¾‹å¤–ï¼ˆä¾‹: RuntimeExceptionã‚„ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ï¼‰ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

Â * Controllerå±¤ã¸ã®ä¼æ’­:

Â  Â Serviceå±¤ã‚’å‘¼ã³å‡ºã—ãŸ@Controllerï¼ˆã¾ãŸã¯@RestControllerï¼‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã€ãã®ä¾‹å¤–ã‚’try-catchã—ã¦ã„ãªã„å ´åˆã€ä¾‹å¤–ã¯ã•ã‚‰ã«å‘¼ã³å‡ºã—å…ƒï¼ˆSpring MVCã®DispatcherServletï¼‰ã¸ã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

Â * DispatcherServletã«ã‚ˆã‚‹ä¾‹å¤–æ•æ‰:

Â  Â DispatcherServletãŒã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸä¾‹å¤–ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

Â * HandlerExceptionResolverã«ã‚ˆã‚‹å‡¦ç†è©¦è¡Œ:

Â  Â DispatcherServletã¯ã€ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹HandlerExceptionResolverï¼ˆä¾‹å¤–è§£æ±ºã‚¯ãƒ©ã‚¹ï¼‰ã‚’ä½¿ã£ã¦ã€ã“ã®ä¾‹å¤–ã‚’å‡¦ç†ã—ã‚ˆã†ã¨è©¦ã¿ã¾ã™ã€‚

Â  Â * @ExceptionHandlerã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å†…ã‚„@ControllerAdviceã‚¯ãƒ©ã‚¹ã«ï¼‰ã‚ã‚Œã°ã€ExceptionHandlerExceptionResolverãŒãã‚Œã‚’å‡¦ç†ã—ã¾ã™ã€‚

Â  Â * @ResponseStatusã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¾‹å¤–ã‚¯ãƒ©ã‚¹ã«ã‚ã‚Œã°ã€ResponseStatusExceptionResolverãŒHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚

Â  Â * ãã®ä»–ã€Springæ¨™æº–ã®ä¾‹å¤–ã¯DefaultHandlerExceptionResolverãŒå‡¦ç†ã—ã¾ã™ã€‚

Â * ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¨ãƒ©ãƒ¼ä¼æ’­:

Â  Â ã‚‚ã—ã€ä¸Šè¨˜ã®HandlerExceptionResolverãŒã„ãšã‚Œã‚‚ä¾‹å¤–ã‚’å‡¦ç†ã—ãªã‹ã£ãŸï¼ˆã¾ãŸã¯å‡¦ç†ã§ããªã‹ã£ãŸï¼‰å ´åˆã€DispatcherServletã¯æœ€çµ‚çš„ã«ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠï¼ˆä¾‹: Tomcatï¼‰ã«ä¾‹å¤–ã‚’ãã®ã¾ã¾ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚

Â * ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠã®ã‚¨ãƒ©ãƒ¼å‡¦ç†:

Â  Â ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠã¯ã€æ•æ‰ã—ãŸä¾‹å¤–ï¼ˆã¾ãŸã¯è¨­å®šã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼‰ã«åŸºã¥ã„ã¦ã€è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

Â * /errorã¸ã®ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰:

Â  Â Spring Bootã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¨ãƒ©ãƒ¼å‡¦ç†ã«ãƒ•ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠãŒã‚¨ãƒ©ãƒ¼ã‚’æ¤œçŸ¥ã™ã‚‹ã¨ã€Spring Bootã®ErrorPageFilterï¼ˆã‚„ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã®è¨­å®šï¼‰ãŒã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†…éƒ¨çš„ã«/errorã¨ã„ã†ãƒ‘ã‚¹ã«**ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ï¼ˆè»¢é€ï¼‰**ã—ã¾ã™ã€‚ã“ã®ã¨ãã€ç™ºç”Ÿã—ãŸä¾‹å¤–æƒ…å ±ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±æ€§ï¼ˆjavax.servlet.error.exceptionãªã©ï¼‰ã¨ã—ã¦å¼•ãç¶™ãŒã‚Œã¾ã™ã€‚

Â * BasicErrorControllerã«ã‚ˆã‚‹å‡¦ç†:

Â  Â ã“ã®/errorã¸ã®å†…éƒ¨çš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€å†åº¦DispatcherServletã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã¾ã™ã€‚

Â  Â DispatcherServletã¯ã€/errorãƒ‘ã‚¹ã«å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨ã—ã¦ã€Spring BootãŒè‡ªå‹•è¨­å®šã™ã‚‹BasicErrorControllerï¼ˆã¾ãŸã¯ã‚ãªãŸãŒãã‚Œã‚’ç¶™æ‰¿ã—ã¦ä½œæˆã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¹ï¼‰ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚

Â  Â BasicErrorControllerã®errorHtml()ï¼ˆHTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ï¼‰ã¾ãŸã¯error()ï¼ˆJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ï¼‰ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±æ€§ã‹ã‚‰ä¾‹å¤–æƒ…å ±ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã€æœ€çµ‚çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆHTMLãƒšãƒ¼ã‚¸ã‚„JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’ç”Ÿæˆã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã—ã¾ã™ã€‚

ğŸ”„ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå‘¼ã°ã‚Œã‚‹é †ç•ª

ã¾ã¨ã‚ã‚‹ã¨ã€ä¾‹å¤–ç™ºç”Ÿæ™‚ã®å‘¼ã³å‡ºã—é †åºã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Â * é€šå¸¸ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå‘¼ã°ã‚Œã‚‹:

Â  Â ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆä¾‹: /my-apiï¼‰ã«ã‚ˆã‚Šã€ã¾ãšã‚ãªãŸã®ä½œæˆã—ãŸé€šå¸¸ã®@Controllerï¼ˆä¾‹: MyApiControllerï¼‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

Â * ä¾‹å¤–ç™ºç”Ÿã¨ä¼æ’­:

Â  Â ãã®ãƒ¡ã‚½ãƒƒãƒ‰å†…éƒ¨ã§å‘¼ã³å‡ºã•ã‚ŒãŸServiceå±¤ã§ä¾‹å¤–ãŒç™ºç”Ÿã—ã€MyApiControllerã‚‚ãã‚Œã‚’ã‚­ãƒ£ãƒƒãƒã›ãšã€DispatcherServletã¾ã§ã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

Â * @ExceptionHandlerãªã©ã®ãƒã‚§ãƒƒã‚¯:

Â  Â DispatcherServletã¯ã€MyApiControllerå†…ã‚„@ControllerAdviceã«å®šç¾©ã•ã‚ŒãŸ@ExceptionHandlerã§ã€ã“ã®ä¾‹å¤–ã‚’å‡¦ç†ã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

Â * /errorã¸ã®ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰:

Â  Â ã‚‚ã—@ExceptionHandlerãªã©ã§å‡¦ç†ã•ã‚Œãªã‹ã£ãŸå ´åˆã€å‰è¿°ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ5ã€œ7ï¼‰ã‚’çµŒã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ/errorãƒ‘ã‚¹ã«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚

Â * ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå‘¼ã°ã‚Œã‚‹:

Â  Â DispatcherServletãŒã“ã®/errorãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€BasicErrorControllerï¼ˆã¾ãŸã¯ãã‚Œã‚’ç¶™æ‰¿ã—ãŸã‚ãªãŸã®ã‚¯ãƒ©ã‚¹ï¼‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

> ãƒã‚¤ãƒ³ãƒˆ:

> BasicErrorControllerï¼ˆã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ï¼‰ã¯ã€é€šå¸¸ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§å‡¦ç†ã—ãã‚Œãªã‹ã£ãŸä¾‹å¤–ãŒç™ºç”Ÿã—ãŸçµæœã€æ”¹ã‚ã¦åˆ¥ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆ/errorï¼‰ã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹ã€ã¨ã„ã†ç‚¹ãŒé‡è¦ã§ã™ã€‚Serviceå±¤ã®ä¾‹å¤–ãŒã€Œç›´æ¥ã€ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«æ¸¡ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚




ã¯ã„ã€ãã®ç†è§£ã§å¤§æ ã¯æ­£ã—ã„ã§ã™ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒTomcatï¼ˆã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠï¼‰ã«åˆ°ç€ã—ã€ãã‚ŒãŒSpringã®DispatcherServletã«æ¸¡ã•ã‚Œã€é©åˆ‡ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã«æŒ¯ã‚Šåˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚

ã‚‚ã†å°‘ã—è§£åƒåº¦ã‚’ä¸Šã’ã‚‹ã¨ã€ç‰¹ã«DispatcherServletãŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’å‘¼ã³å‡ºã™ã¾ã§ã«ã€ã„ãã¤ã‹é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ã€‚

ğŸ¯ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«å±Šãã¾ã§

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¦ã€ã‚ãªãŸã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚Œã‚‹ã¾ã§ã®ä¸»è¦ãªæµã‚Œã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

1. Tomcatï¼ˆã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠï¼‰ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡

Â * ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆä¾‹: GET /users/10) ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¬ãƒ™ãƒ«ã§å—ã‘å–ã‚Šã¾ã™ã€‚

Â * ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ‘ãƒ¼ã‚¹ã—ã€Javaã§æ‰±ãˆã‚‹HttpServletRequestã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨HttpServletResponseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

2. Servlet Filter Chain (ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿)

Â * Tomcatã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’**DispatcherServletã«æ¸¡ã™å‰ã«**ã€ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã€Œãƒ•ã‚£ãƒ«ã‚¿ãƒã‚§ãƒ¼ãƒ³ã€ã«é€šã—ã¾ã™ã€‚

Â * Spring Bootã§ã¯ã€æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®šã€CORSè¨­å®šã€ãã—ã¦éå¸¸ã«é‡è¦ãªSpring Securityã«ã‚ˆã‚‹èªè¨¼ãƒ»èªå¯ãªã©ãŒã€ã“ã®ãƒ•ã‚£ãƒ«ã‚¿å±¤ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

Â * ã‚‚ã—èªè¨¼ã‚¨ãƒ©ãƒ¼ãªã©ãŒã‚ã‚Œã°ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯DispatcherServletã«åˆ°é”ã™ã‚‹å‰ã«ã“ã“ã§æ­¢ã‚ã‚‰ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

3. DispatcherServlet (ãƒ•ãƒ­ãƒ³ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼)

Â * ãƒ•ã‚£ãƒ«ã‚¿ãƒã‚§ãƒ¼ãƒ³ã‚’é€šéã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€Spring MVCã®ä¸­å¿ƒçš„ãªçª“å£ã§ã‚ã‚‹DispatcherServletãŒå—ã‘å–ã‚Šã¾ã™ã€‚

Â * DispatcherServletã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨é€£æºã—ã¾ã™ã€‚

4. HandlerMapping (ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°)

Â * DispatcherServletã¯ã€ã¾ãšHandlerMappingã«ã€Œã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆURLã€HTTPãƒ¡ã‚½ãƒƒãƒ‰ã€ãƒ˜ãƒƒãƒ€ãƒ¼ãªã©ï¼‰ã‚’å‡¦ç†ã™ã¹ãã¯èª°ã‹ï¼Ÿã€ã¨å•ã„åˆã‚ã›ã¾ã™ã€‚

Â * HandlerMappingã¯ã€@RequestMappingã‚„@GetMappingãªã©ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãŠã‚Šã€ã€ŒUserControllerã®getUserãƒ¡ã‚½ãƒƒãƒ‰ãŒæ‹…å½“ã§ã™ã€ã¨ã„ã†æƒ…å ±ï¼ˆHandlerMethodã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’DispatcherServletã«è¿”ã—ã¾ã™ã€‚

5. HandlerInterceptor (ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼)

Â * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæ±ºå®šã—ãŸå¾Œã€DispatcherServletã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ç›´å‰ã«HandlerInterceptorã«é€šã—ã¾ã™ã€‚

Â * ã“ã‚Œã¯ã€ãƒ­ã‚°å‡ºåŠ›ã‚„ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®äº‹å‰ãƒã‚§ãƒƒã‚¯ãªã©ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ã¯åˆ¥ã®ã€Œå…±é€šçš„ãªå‰å‡¦ç†ã€ã‚’è¡Œã†ãŸã‚ã«ä½¿ã‚ã‚Œã¾ã™ã€‚

6. HandlerAdapter (ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼)

Â * DispatcherServletã¯ã€æ¬¡ã«HandlerAdapterã«å¯¾ã—ã¦ã€Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆgetUserï¼‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€ã¨ä¾é ¼ã—ã¾ã™ã€‚

Â * HandlerAdapterã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆHttpServletRequestï¼‰ã‹ã‚‰å¿…è¦ãªæƒ…å ±ã‚’å–ã‚Šå‡ºã—ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ï¼ˆä¾‹: @PathVariableã‚„@RequestBodyï¼‰ã«é©åˆ‡ã«å¤‰æ›ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã—ã¦ã€å®Ÿéš›ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

æŠ¼ã•ãˆã¦ãŠããƒã‚¤ãƒ³ãƒˆ

Â * DispatcherServletãŒä¸­å¿ƒ: Spring MVCã§ã¯ã€ã»ã¼å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã¾ãšDispatcherServletã‚’é€šéã—ã¾ã™ã€‚

Â * ãƒ•ã‚£ãƒ«ã‚¿ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã®é•ã„:

Â  Â * ãƒ•ã‚£ãƒ«ã‚¿ (Filter): DispatcherServletã®å¤–å´ï¼ˆæ‰‹å‰ï¼‰ã§å‹•ä½œã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆä»•æ§˜ã®æ©Ÿèƒ½ã§ã™ã€‚

Â  Â * ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ (Interceptor): DispatcherServletã®å†…å´ã§ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å®Ÿè¡Œã®ç›´å‰ãƒ»ç›´å¾Œã«å‹•ä½œã—ã¾ã™ã€‚Spring MVCå›ºæœ‰ã®æ©Ÿèƒ½ã§ã™ã€‚

ã“ã®æµã‚Œã‚’æ„è­˜ã—ã¦ãŠãã¨ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆãƒ•ã‚£ãƒ«ã‚¿ï¼‰ã‚„å…±é€šå‡¦ç†ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼‰ã‚’ã©ã“ã«å®Ÿè£…ã™ã¹ãã‹ã€ãƒ‡ãƒãƒƒã‚°æ™‚ã«ã©ã“ã§å•é¡ŒãŒèµ·ãã¦ã„ã‚‹ã‹ã‚’ç‰¹å®šã—ã‚„ã™ããªã‚Šã¾ã™ã€‚





ã¯ã„ã€æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚

Spring Bootã®èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¨åŒã˜ãã‚‰ã„é‡è¦ã§ã™ã€‚æŠ‘ãˆã¦ãŠãã¹ããƒã‚¤ãƒ³ãƒˆã¯ã€ã€Œã„ã‹ã«ã—ã¦Spring BootãŒè¨­å®šã‚’èª­ã¿è¾¼ã¿ã€å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆBeanï¼‰ã‚’çµ„ã¿ç«‹ã¦ã€Webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã‹ã€ã§ã™ã€‚

æµã‚Œã‚’å¤§ããåˆ†ã‘ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ğŸš€ 1. èµ·å‹•ã®èµ·ç‚¹: main ãƒ¡ã‚½ãƒƒãƒ‰ã¨ @SpringBootApplication

ã™ã¹ã¦ã®å§‹ã¾ã‚Šã¯ã€ãŠãªã˜ã¿ã® main ãƒ¡ã‚½ãƒƒãƒ‰å†…ã«ã‚ã‚‹ SpringApplication.run(...) ã§ã™ã€‚

@SpringBootApplication

public class MyApplication {

Â  Â  public static void main(String[] args) {

Â  Â  Â  Â  SpringApplication.run(MyApplication.class, args); // èµ·å‹•ï¼

Â  Â  }

}

  

ã“ã® run ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã€Spring Bootã¯èµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã—ã¾ã™ã€‚

åŒæ™‚ã«ã€@SpringBootApplication ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ¥µã‚ã¦é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä»¥ä¸‹ã®3ã¤ã®æ©Ÿèƒ½ã®é›†åˆä½“ã§ã™ã€‚

Â * @Configuration: ã“ã®ã‚¯ãƒ©ã‚¹ãŒè¨­å®šæƒ…å ±ã‚’æŒã¤ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

Â * @EnableAutoConfiguration: ã“ã‚ŒãŒSpring Bootã®ã€Œé­”æ³•ã€ã®æ ¸å¿ƒã§ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚

Â * @ComponentScan: ã“ã®ã‚¯ãƒ©ã‚¹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä»¥ä¸‹ã«ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ@Service, @Controllerãªã©ï¼‰ã‚’æ¢ã™ã‚ˆã†æŒ‡ç¤ºã—ã¾ã™ã€‚

ğŸª„ 2. è‡ªå‹•è¨­å®š (Auto-Configuration) ã®å®Ÿè¡Œ

@EnableAutoConfiguration ãŒèµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€å¤§ã®ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

Â * ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ã®ç›£è¦–: Spring Bootã¯ã€ã‚ãªãŸãŒ pom.xml ã‚„ build.gradle ã«è¿½åŠ ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆStarterï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

Â * ã€Œæ¨æ¸¬ã€ã¨è¨­å®š:

Â  Â * ã‚‚ã— spring-boot-starter-web ãŒã‚ã‚Œã°ã€ã€Œã“ã‚Œã¯Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã ãªã€‚Tomcatã¨DispatcherServletãŒå¿…è¦ã ã€ã¨åˆ¤æ–­ã—ã€ãã‚Œã‚‰ã‚’èµ·å‹•ãƒ»è¨­å®šã™ã‚‹Beanã‚’è‡ªå‹•çš„ã«æº–å‚™ã—ã¾ã™ã€‚

Â  Â * ã‚‚ã— spring-boot-starter-data-jpa ã¨ h2 (H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹) ãŒã‚ã‚Œã°ã€ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒå¿…è¦ã ãªã€‚H2ã®ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¨­å®šã—ã‚ˆã†ã€ã¨åˆ¤æ–­ã—ã€DataSource Beanã‚’è‡ªå‹•çš„ã«æº–å‚™ã—ã¾ã™ã€‚

Â * è¨­å®šã®ä¸Šæ›¸ã: è‡ªå‹•è¨­å®šã¯ä¾¿åˆ©ã§ã™ãŒã€ã‚‚ã—ã‚ãªãŸãŒ application.properties (ã¾ãŸã¯ .yml) ã« server.port=8081 ã¨æ›¸ã„ãŸã‚Šã€ç‹¬è‡ªã® DataSource Beanã‚’å®šç¾©ã—ãŸã‚Šã™ã‚Œã°ã€å¸¸ã«ã‚ãªãŸè‡ªèº«ã®å®šç¾©ãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚

ğŸ—ï¸ 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã¨DIã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰

æ¬¡ã«ã€@ComponentScan ãŒæ©Ÿèƒ½ã—ã¾ã™ã€‚

Â * ã‚¹ã‚­ãƒ£ãƒ³: @SpringBootApplication ãŒè²¼ã‚‰ã‚ŒãŸã‚¯ãƒ©ã‚¹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åŸºç‚¹ã«ã€ãã‚Œä»¥ä¸‹ã®å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚

Â * Beanã®ç™»éŒ²: @Component, @Service, @Repository, @Controller, @Configuration ã¨ã„ã£ãŸã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒã¤ã„ãŸã‚¯ãƒ©ã‚¹ã‚’æ¢ã—å‡ºã—ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

Â * DI (ä¾å­˜æ€§æ³¨å…¥): SpringãŒç®¡ç†ã™ã‚‹ã“ã‚Œã‚‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆï¼Beanï¼‰ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚

Â  Â * ä¾‹ãˆã°ã€MyController ãŒ @Autowired ã§ MyService ã‚’è¦æ±‚ã—ã¦ã„ã‚Œã°ã€SpringãŒ MyService ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ MyController ã«æ³¨å…¥ï¼ˆã‚»ãƒƒãƒˆï¼‰ã—ã¾ã™ã€‚

Â * ApplicationContext ã®å®Œæˆ: ã™ã¹ã¦ã®BeanãŒç”Ÿæˆã•ã‚Œã€ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºã•ã‚ŒãŸçŠ¶æ…‹ï¼ˆDIã‚³ãƒ³ãƒ†ãƒŠï¼‰ãŒå®Œæˆã—ã¾ã™ã€‚ã“ã‚ŒãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œæœ¬ä½“ã€ã¨ãªã‚Šã¾ã™ã€‚

ğŸ 4. çµ„ã¿è¾¼ã¿ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã¨èµ·å‹•å¾Œå‡¦ç†

Â * ã‚µãƒ¼ãƒãƒ¼èµ·å‹•: ã‚¹ãƒ†ãƒƒãƒ—2ï¼ˆè‡ªå‹•è¨­å®šï¼‰ã§æº–å‚™ã•ã‚ŒãŸçµ„ã¿è¾¼ã¿Webã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯Tomcatï¼‰ãŒã€ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§èµ·å‹•ã—ã¾ã™ã€‚application.properties ã§æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯8080ï¼‰ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¾…å—ã‚’é–‹å§‹ã—ã¾ã™ã€‚

Â * CommandLineRunner ã®å®Ÿè¡Œ: ã‚‚ã—ã€ã‚ãªãŸãŒ CommandLineRunner (ã¾ãŸã¯ ApplicationRunner) ã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ãŸBeanã‚’å®šç¾©ã—ã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚‰ãŒèµ·å‹•ç›´å¾Œã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

Â  Â * ã“ã‚Œã¯ã€èµ·å‹•æ™‚ã«åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æŠ•å…¥ã—ãŸã‚Šã€èµ·å‹•å®Œäº†ã®ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã‚Šã™ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå®Œäº†ã™ã‚‹ã¨ã€Spring Bootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã‚‰ã‚Œã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

æŠ‘ãˆã¦ãŠãã¹ããƒã‚¤ãƒ³ãƒˆã¾ã¨ã‚

Â * @SpringBootApplication ãŒèµ·å‹•ã®ãƒˆãƒªã‚¬ãƒ¼ã§ã‚ã‚Šã€ã‚¹ã‚­ãƒ£ãƒ³ç¯„å›²ã®åŸºç‚¹ã§ã™ã€‚

Â * Auto-Configuration ãŒã€pom.xmlã‚’è¦‹ã¦ã€Tomcatã®èµ·å‹•ã‚„DBæ¥ç¶šãªã©ã€é¢å€’ãªè¨­å®šã®ã»ã¨ã‚“ã©ã‚’è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚

Â * @ComponentScan ãŒã€ã‚ãªãŸã®æ›¸ã„ãŸ @Service ã‚„ @Controller ã‚’è¦‹ã¤ã‘ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¾ã™ã€‚

Â * ApplicationContext ã¯ã€ä½œã‚‰ã‚ŒãŸå…¨Beanï¼ˆéƒ¨å“ï¼‰ãŒæ ¼ç´ã•ã‚Œã€DIã«ã‚ˆã£ã¦çµ„ã¿ç«‹ã¦ã‚‰ã‚ŒãŸã€Œå®Œæˆå“ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã€ãã®ã‚‚ã®ã§ã™ã€‚

ã“ã®èµ·å‹•ã®æµã‚Œã‚‚ã€Mermaidå›³ã§å¯è¦–åŒ–ã™ã‚‹ã¨ç†è§£ãŒæ·±ã¾ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å¿…è¦ã§ã‚ã‚Œã°ãŠå£°ãŒã‘ãã ã•ã„ã€‚

ã¯ã„ã€ã‚‚ã¡ã‚ã‚“ã§ã™ã€‚

å‰å›ã®ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«å±Šãã¾ã§ã€ã®å‡¦ç†ã®æµã‚Œã‚’Mermaidå›³ï¼ˆãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼‰ã«ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```mermaid
graph TD

Â  Â  A[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] --> BTomcat / ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ);

Â  Â  B --> C(Servlet Filter Chain<br>Spring Securityãªã©);

Â  Â  C --> D(DispatcherServlet<br>ãƒ•ãƒ­ãƒ³ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼);

Â  Â  D -- 1. èª°ãŒå‡¦ç†ã™ã‚‹ï¼Ÿ --> E(HandlerMapping);

Â  Â  E -- 2. "Controllerã®Xãƒ¡ã‚½ãƒƒãƒ‰" --> D;

Â  Â  D -- 3. å®Ÿè¡Œç›´å‰ã®å…±é€šå‡¦ç† --> F(HandlerInterceptor<br>preHandle);

Â  Â  F -- 4. å®Ÿè¡Œ --> G(HandlerAdapter);

Â  Â  G -- 5. å¼•æ•°ã‚’è§£æ±ºãƒ»å¤‰æ›ã—ã¦å®Ÿè¡Œ --> H[ã‚ãªãŸã®Controllerãƒ¡ã‚½ãƒƒãƒ‰];

  

Â  Â  %% ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

Â  Â  style H fill:#f9f,stroke:#333,stroke-width:2px
```


  



