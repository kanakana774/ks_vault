関数に関する問題

## 問題 1: 顧客名とメールアドレスを結合して表示する

### 重要度: ★★★★

### 問題目的: CONCAT()関数または||演算子を使用して、複数の文字列を結合する方法を理解する。

## 問題: customers_mst テーブルから、顧客の名前とメールアドレスを CONCAT 関数（または||演算子）で結合し、「顧客名 (メールアドレス)」の形式で表示してください。エイリアスは customer_contact としてください。

### 答え:

```SQL
SELECT
	CONCAT(CUSTOMER_NAME, ' (', EMAIL, ')') AS CUSTOMER_CONTACT
FROM
	CUSTOMERS_MST;
```

### バリエーション (PostgreSQL の||演算子):

```SQL
SELECT
	CUSTOMER_NAME || ' (' || EMAIL || ')' AS CUSTOMER_CONTACT
FROM
	CUSTOMERS_MST;
```

## 問題 2: 商品名の短縮形と大文字・小文字変換

### 重要度: ★★★★

### 問題目的: SUBSTRING(), UPPER(), LOWER()関数を使用して文字列を加工する方法を理解する。

## 問題: products_mst テーブルから、以下の形式で商品名を表示してください。

商品名の最初の 3 文字を抽出して表示する (short_name として)。
商品名を全て大文字に変換して表示する (upper_name として)。
商品名を全て小文字に変換して表示する (lower_name として)。

### 答え:

```SQL
SELECT
	PRODUCT_NAME,
	SUBSTRING(
		PRODUCT_NAME
		FROM
			1 FOR 3
	) AS SHORT_NAME,
	UPPER(PRODUCT_NAME) AS UPPER_NAME,
	LOWER(PRODUCT_NAME) AS LOWER_NAME
FROM
	PRODUCTS_MST;
```

## 問題 3: 商品メモの空白を除去する

### 重要度: ★★★★

### 問題目的: TRIM()関数を使用して、文字列の両端の空白文字を除去する方法を理解する。

## 問題: products_mst テーブルの memo 列に、もし余分な空白が含まれている場合を想定し、その空白を両端から除去したメモの内容を表示してください。元のメモとトリム後のメモの両方を表示し、メモが NULL ではないもののみを対象とします。

### 答え:

```SQL
SELECT
	PRODUCT_NAME,
	MEMO AS ORIGINAL_MEMO,
	TRIM(MEMO) AS TRIMMED_MEMO
FROM
	PRODUCTS_MST
WHERE
	MEMO IS NOT NULL;
```

備考：スペースが含まれるデータ作ってからじゃないと動作確認できないな。。。

## 問題 4: 現在の日付と時刻を取得し、特定の形式で表示する

### 重要度: ★★★★

### 問題目的: NOW()または CURRENT_TIMESTAMP で現在日時を取得し、TO_CHAR()で日付を整形する方法を理解する。

## 問題:

現在のシステム日時を取得してください。
現在のシステム日時を「YYYY 年 MM 月 DD 日 HH 時 MI 分 SS 秒」の形式で表示してください。

### 答え:

現在のシステム日時

```SQL
SELECT NOW() AS current_datetime;
```

整形された現在日時

```SQL
SELECT TO_CHAR(NOW(), 'YYYY 年 MM 月 DD 日 HH24 時 MI 分 SS 秒') AS formatted_datetime;
```

## 問題 5: 注文日の翌週の同じ曜日を計算する

### 重要度: ★★★★★

### 問題目的: INTERVAL キーワードを使用して日付に期間を加算する方法を理解する。

## 問題: orders_trn テーブルから、各注文の注文日と、その注文日の**7 日後（翌週の同じ曜日）**の日付を計算して表示してください。

### 答え:

```SQL
SELECT
	ORDER_ID,
	ORDER_DATE,
	ORDER_DATE + INTERVAL '7 day' AS NEXT_WEEK_DATE
FROM
	ORDERS_TRN;
```

## 問題 6: 顧客の登録月を抽出する

### 重要度: ★★★★

### 問題目的: EXTRACT()関数を使用して日付から特定の部分（月）を抽出する方法を理解する。

## 問題: customers_mst テーブルから、各顧客の登録日（created_date）の月を数値で抽出して表示してください。

### 答え:

```SQL
SELECT
	CUSTOMER_NAME,
	CREATED_DATE,
	EXTRACT(
		MONTH
		FROM
			CREATED_DATE
	) AS REGISTRATION_MONTH
FROM
	CUSTOMERS_MST;
```

備考：https://www.postgresql.jp/document/17/html/functions-datetime.html#FUNCTIONS-DATETIME-EXTRACT

## 問題 7: 注文日の曜日名を表示する

### 重要度: ★★★★★

### 問題目的: TO_CHAR()関数を使用して日付から曜日名を抽出する方法を理解する。

## 問題: orders_trn テーブルから、各注文の注文日と、その注文日が何曜日かを日本語のフルネーム（例: '月曜日', '火曜日'）で表示してください。

### 答え:

```SQL
SELECT
	ORDER_ID,
	ORDER_DATE,
	TO_CHAR(ORDER_DATE, 'Day') AS ORDER_DAY_OF_WEEK -- PostgreSQL では'Day'が曜日名を返す
FROM
	ORDERS_TRN;
```

### 補足: PostgreSQL の TO_CHAR 関数は、環境のロケール設定によっては英語の曜日名（e.g., 'Monday')を返す場合があります。日本語の曜日名を得るには LC_TIME 設定などが必要になることがありますが、基本的な使い方として'Day'を指定します。

## 問題 8: 顧客メールアドレスのドメイン名抽出

### 重要度: ★★★★★

### 問題目的: 文字列関数を組み合わせて、特定のパターン（この場合は@より後ろ）を抽出する方法を理解する。

## 問題: customers_mst テーブルから、各顧客のメールアドレスからドメイン名のみを抽出して表示してください。（例: sato.taro@example.com から example.com を抽出）

### 答え:

```SQL
SELECT
	CUSTOMER_NAME,
	EMAIL,
	SUBSTRING(
		EMAIL
		FROM
			POSITION('@' IN EMAIL) + 1
	) AS EMAIL_DOMAIN
FROM
	CUSTOMERS_MST;
```

### バリエーション (PostgreSQL の SPLIT_PART 関数):

```SQL
SELECT
	CUSTOMER_NAME,
	EMAIL,
	SPLIT_PART(EMAIL, '@', 2) AS EMAIL_DOMAIN
FROM
	CUSTOMERS_MST;
```

## 問題 9: 商品名の文字長を取得する

### 重要度: ★★★★

### 問題目的: LENGTH()または CHAR_LENGTH()関数を使用して、文字列の長さを取得する方法を理解する。

## 問題: products_mst テーブルから、商品名とその文字長を両方表示してください。

### 答え:

```SQL
SELECT
	PRODUCT_NAME,
	LENGTH(PRODUCT_NAME) AS PRODUCT_NAME_LENGTH -- 文字列のバイト長を返す場合がある (ASCII 文字以外は注意)
	-- CHAR_LENGTH(product_name) AS product_name_char_length -- 文字数を返す (PostgreSQL 推奨)
FROM
	PRODUCTS_MST;
```

### 補足: LENGTH()は多くの場合バイト長を返しますが、PostgreSQL では文字数を返します。より確実に文字数を取得するには CHAR_LENGTH()（または CHARACTER_LENGTH()）が推奨されます。

## 問題 10: NULL のメモを「メモなし」と表示する

### 重要度: ★★★★★

### 問題目的: COALESCE()関数を使用して、NULL 値が返される可能性のある式や列に対して、代替の非 NULL 値を指定する方法を理解する。

## 問題: products_mst テーブルから、商品名とメモを表示してください。ただし、メモ(memo)が NULL の場合は、'メモなし'という文字列を代わりに表示してください。

### 答え:

```SQL
SELECT
	PRODUCT_NAME,
	COALESCE(MEMO, 'メモなし') AS DISPLAY_MEMO
FROM
	PRODUCTS_MST;
```

### 補足: COALESCE 関数は引数を左から順に評価し、最初に NULL ではない値を返します。これにより、NULL 値をユーザーにとって分かりやすい代替値に変換できます。
