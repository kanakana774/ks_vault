## SQLå¿œç”¨ï¼šCASEå¼ã«ã‚ˆã‚‹é«˜åº¦ãªæ¡ä»¶åˆ†å²ï¼ˆå®Ÿè·µã‚¬ã‚¤ãƒ‰ï¼‰

### 1. CASEå¼ã¨ã¯ï¼Ÿ

CASEå¼ã¯ã€SQLã‚¯ã‚¨ãƒªå†…ã§æ¡ä»¶ã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†å²ã•ã›ã‚‹ãŸã‚ã®æ§‹æ–‡ã§ã™ã€‚å¤šãã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªžã«ãŠã‘ã‚‹ `if-then-else` ã‚„ `switch` æ–‡ã®ã‚ˆã†ã«ã€ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã€åˆ†é¡žã€é›†è¨ˆã€ä¸¦ã³æ›¿ãˆãªã©ã€æ§˜ã€…ãªå ´é¢ã§æ´»ç”¨ã§ãã‚‹å¼·åŠ›ãªæ©Ÿèƒ½ã§ã™ã€‚

**ä¸»ãªç”¨é€”:**
*   **`SELECT`å¥**: æ¡ä»¶ã«åŸºã¥ã„ã¦å€¤ã‚’å¤‰æ›ã—ã€æ–°ã—ã„åˆ—ã‚’ä½œæˆã™ã‚‹ã€‚
*   **`GROUP BY`ã¨é›†è¨ˆé–¢æ•°**: æ¡ä»¶ã«åˆã†ãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’é›†è¨ˆã™ã‚‹ï¼ˆã‚¯ãƒ­ã‚¹é›†è¨ˆï¼‰ã€‚
*   **`ORDER BY`å¥**: ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«ã§ãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã³é †ã‚’åˆ¶å¾¡ã™ã‚‹ã€‚
*   **`WHERE`å¥**: æ¡ä»¶ã«ã‚ˆã£ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å‹•çš„ã«å¤‰æ›´ã™ã‚‹ã€‚


### 2. CASEå¼ã®åŸºæœ¬æ§‹æ–‡

CASEå¼ã«ã¯ã€Œã‚·ãƒ³ãƒ—ãƒ«CASEå¼ã€ã¨ã€Œæ¤œç´¢CASEå¼ã€ã®2ã¤ã®æ›¸ãæ–¹ãŒã‚ã‚Šã¾ã™ã€‚

#### ã‚·ãƒ³ãƒ—ãƒ«CASEå¼
ç‰¹å®šã®**1ã¤ã®åˆ—ã®å€¤**ãŒä½•ã‹ã«ã‚ˆã£ã¦å‡¦ç†ã‚’åˆ†å²ã•ã›ã‚‹å ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚

```sql
CASE åˆ—å
  WHEN å€¤1 THEN çµæžœ1
  WHEN å€¤2 THEN çµæžœ2
  ...
  [ELSE ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµæžœ]
END
```

#### æ¤œç´¢CASEå¼
ã‚ˆã‚Šè¤‡é›‘ãª**æ¡ä»¶å¼**ï¼ˆæ¯”è¼ƒæ¼”ç®—å­ã‚„è«–ç†æ¼”ç®—å­ãªã©ï¼‰ã‚’ç”¨ã„ã¦åˆ†å²ã•ã›ã‚‹ã€ã‚ˆã‚ŠæŸ”è»Ÿã§ä¸€èˆ¬çš„ã«ä½¿ã‚ã‚Œã‚‹å½¢å¼ã§ã™ã€‚

```sql
CASE
  WHEN æ¡ä»¶å¼1 THEN çµæžœ1
  WHEN æ¡ä»¶å¼2 THEN çµæžœ2
  ...
  [ELSE ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµæžœ]
END
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
*   `WHEN`å¥ã¯ä¸Šã‹ã‚‰é †ã«è©•ä¾¡ã•ã‚Œã€æœ€åˆã«çœŸ (TRUE) ã¨ãªã£ãŸæ¡ä»¶ã®çµæžœãŒè¿”ã•ã‚Œã¾ã™ã€‚**è¨˜è¿°ã™ã‚‹é †åºãŒéžå¸¸ã«é‡è¦ã§ã™ã€‚**
*   `ELSE`å¥ã‚’çœç•¥ã—ã€ã©ã®`WHEN`å¥ã«ã‚‚åˆè‡´ã—ãªã‹ã£ãŸå ´åˆã€çµæžœã¯ `NULL` ã¨ãªã‚Šã¾ã™ã€‚



### 3. åˆ©ç”¨ã‚·ãƒ¼ãƒ³åˆ¥ã®æ´»ç”¨ä¾‹

#### A. `SELECT`å¥ã§ã®åˆ©ç”¨ï¼šãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã¨åˆ†é¡ž

`SELECT`å¥ã§CASEå¼ã‚’ä½¿ã†ã¨ã€æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ–°ã—ã„æ„å‘³ã‚’æŒã¤åˆ—ã‚’å‹•çš„ã«ä½œæˆã§ãã¾ã™ã€‚

**ä¾‹1ï¼šç¤¾å“¡ã®å½¹è·ã«å¿œã˜ã¦ã€Œå½¹å‰²ã€ã‚’åˆ†é¡žã™ã‚‹**
ç¤¾å“¡ãƒ†ãƒ¼ãƒ–ãƒ«ã®å½¹è·ï¼ˆ`position`ï¼‰ã«åŸºã¥ã„ã¦ã€æ–°ã—ã„ã€Œå½¹å‰²ï¼ˆ`role`ï¼‰ã€åˆ—ã‚’ä½œæˆã—ã¾ã™ã€‚

**SQLã‚¯ã‚¨ãƒªï¼ˆWITHå¥ã§äº‹å‰ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼‰**
```sql
WITH employees AS (
  SELECT 'å±±ç”° å¤ªéƒŽ' AS name, 'éƒ¨é•·' AS position UNION ALL
  SELECT 'éˆ´æœ¨ èŠ±å­', 'èª²é•·' UNION ALL
  SELECT 'ä½è—¤ æ¬¡éƒŽ', 'ãƒªãƒ¼ãƒ€ãƒ¼' UNION ALL
  SELECT 'ç”°ä¸­ ä¸‰éƒŽ', 'ä¸€èˆ¬' UNION ALL
  SELECT 'é«˜æ©‹ å››éƒŽ', NULL
)
SELECT
  name,
  position,
  CASE position
    WHEN 'éƒ¨é•·' THEN 'çµŒå–¶å±¤'
    WHEN 'èª²é•·' THEN 'ç®¡ç†è·'
    WHEN 'ãƒªãƒ¼ãƒ€ãƒ¼' THEN 'ç®¡ç†è·'
    ELSE 'ãƒ¡ãƒ³ãƒãƒ¼'
  END AS role
FROM
  employees;
```

**å®Ÿè¡Œçµæžœ**

| name  | position | role |
| :---- | :------- | :--- |
| å±±ç”° å¤ªéƒŽ | éƒ¨é•·       | çµŒå–¶å±¤  |
| éˆ´æœ¨ èŠ±å­ | èª²é•·       | ç®¡ç†è·  |
| ä½è—¤ æ¬¡éƒŽ | ãƒªãƒ¼ãƒ€ãƒ¼     | ç®¡ç†è·  |
| ç”°ä¸­ ä¸‰éƒŽ | ä¸€èˆ¬       | ãƒ¡ãƒ³ãƒãƒ¼ |
| é«˜æ©‹ å››éƒŽ | NULL     | ãƒ¡ãƒ³ãƒãƒ¼ |
*`position`ãŒ`NULL`ã®é«˜æ©‹ã•ã‚“ã¯ã€ã©ã®`WHEN`å¥ã«ã‚‚åˆè‡´ã—ãªã„ãŸã‚`ELSE`å¥ã®ã€Œãƒ¡ãƒ³ãƒãƒ¼ã€ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚*


#### B. `ORDER BY`å¥ã§ã®åˆ©ç”¨ï¼šä¸¦ã³é †ã®ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚º

`ORDER BY`å¥ã§CASEå¼ã‚’ä½¿ã†ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ˜‡é †ãƒ»é™é †ã§ã¯å®Ÿç¾ã§ããªã„ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ãŸè¤‡é›‘ãªã‚½ãƒ¼ãƒˆé †ã‚’å®šç¾©ã§ãã¾ã™ã€‚

**ä¾‹2ï¼šå½¹è·é †ã§ã‚½ãƒ¼ãƒˆã—ã€åŒã˜å½¹è·å†…ã§ã¯å…¥ç¤¾æ—¥ã®å¤ã„é †ã«ä¸¦ã¹ã‚‹**
ã€Œéƒ¨é•· â†’ èª²é•· â†’ ãƒªãƒ¼ãƒ€ãƒ¼ â†’ ä¸€èˆ¬ã€ã¨ã„ã†ç‹¬è‡ªã®å½¹è·é †ã§ä¸¦ã¹æ›¿ãˆã€å½¹è·ãŒ`NULL`ã®ç¤¾å“¡ã¯æœ€å¾Œã«è¡¨ç¤ºã—ã¾ã™ã€‚

**SQLã‚¯ã‚¨ãƒªï¼ˆWITHå¥ã§äº‹å‰ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼‰**
```sql
WITH employees AS (
  SELECT 'ä½è—¤ æ¬¡éƒŽ' AS name, 'ãƒªãƒ¼ãƒ€ãƒ¼' AS position, '2018-04-01'::date AS hire_date UNION ALL
  SELECT 'å±±ç”° å¤ªéƒŽ', 'éƒ¨é•·', '2010-04-01'::date UNION ALL
  SELECT 'ç”°ä¸­ ä¸‰éƒŽ', 'ä¸€èˆ¬', '2022-04-01'::date UNION ALL
  SELECT 'ä¼Šè—¤ äº”éƒŽ', 'ä¸€èˆ¬', '2020-10-01'::date UNION ALL
  SELECT 'éˆ´æœ¨ èŠ±å­', 'èª²é•·', '2015-04-01'::date UNION ALL
  SELECT 'é«˜æ©‹ å››éƒŽ', NULL, '2023-04-01'::date
)
SELECT
  name,
  position,
  hire_date
FROM
  employees
ORDER BY
  -- å½¹è·ã«å„ªå…ˆé †ä½ã‚’ä»˜ã‘ã‚‹
  CASE position
    WHEN 'éƒ¨é•·'   THEN 1
    WHEN 'èª²é•·'   THEN 2
    WHEN 'ãƒªãƒ¼ãƒ€ãƒ¼' THEN 3
    WHEN 'ä¸€èˆ¬'   THEN 4
    ELSE 5 -- NULLã‚„ãã®ä»–ã®å½¹è·ã¯æœ€å¾Œ
  END,
  -- åŒã˜å½¹è·å†…ã§ã¯å…¥ç¤¾æ—¥ã®æ˜‡é †ï¼ˆå¤ã„é †ï¼‰
  hire_date;
```

**å®Ÿè¡Œçµæžœ**

| name | position | hire_date |
|:---|:---|:---|
| å±±ç”° å¤ªéƒŽ | éƒ¨é•· | 2010-04-01 |
| éˆ´æœ¨ èŠ±å­ | èª²é•· | 2015-04-01 |
| ä½è—¤ æ¬¡éƒŽ | ãƒªãƒ¼ãƒ€ãƒ¼ | 2018-04-01 |
| ä¼Šè—¤ äº”éƒŽ | ä¸€èˆ¬ | 2020-10-01 |
| ç”°ä¸­ ä¸‰éƒŽ | ä¸€èˆ¬ | 2022-04-01 |
| é«˜æ©‹ å››éƒŽ | NULL | 2023-04-01 |
*`ORDER BY`å¥ã®1ç•ªç›®ã®CASEå¼ã§å…¨ä½“ã®ä¸¦ã³é †ã‚’åˆ¶å¾¡ã—ã€2ç•ªç›®ã®`hire_date`ã§ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ä¸¦ã³é †ã‚’åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚*

è£œè¶³ï¼š
```SQL
WITH employees AS (
  SELECT 'ä½è—¤ æ¬¡éƒŽ' AS name, 'ãƒªãƒ¼ãƒ€ãƒ¼' AS position, '2018-04-01'::date AS hire_date UNION ALL
  SELECT 'å±±ç”° å¤ªéƒŽ', 'éƒ¨é•·', '2010-04-01'::date UNION ALL
  SELECT 'ç”°ä¸­ ä¸‰éƒŽ', 'ä¸€èˆ¬', '2022-04-01'::date UNION ALL
  SELECT 'ä¼Šè—¤ äº”éƒŽ', 'ä¸€èˆ¬', '2020-10-01'::date UNION ALL
  SELECT 'éˆ´æœ¨ èŠ±å­', 'èª²é•·', '2015-04-01'::date UNION ALL
  SELECT 'é«˜æ©‹ å››éƒŽ', NULL, '2023-04-01'::date
)
SELECT
  name,
  position,
  hire_date
FROM
  employees
ORDER BY
  -- å½¹è·ã«å„ªå…ˆé †ä½ã‚’ä»˜ã‘ã‚‹
  CASE position
    WHEN 'éƒ¨é•·'   THEN 'ã‚ã‚ã‚ã‚ã‚ã‚'
    WHEN 'èª²é•·'   THEN 'ã‚ã„'
    WHEN 'ãƒªãƒ¼ãƒ€ãƒ¼' THEN 'ã‚ã†ã‚'
    WHEN 'ä¸€èˆ¬'   THEN 'ã‚ãˆ'
    ELSE 'ã‚ãŠãŠãŠãŠãŠ' -- NULLã‚„ãã®ä»–ã®å½¹è·ã¯æœ€å¾Œ
  END,
  -- åŒã˜å½¹è·å†…ã§ã¯å…¥ç¤¾æ—¥ã®æ˜‡é †ï¼ˆå¤ã„é †ï¼‰
  hire_date;
```

â‡’order by ã¯åŒä¸€ã®åž‹ã§ã‚ã‚Œã°ãã‚Œã‚’æ¯”ã¹ã¦ã‚½ãƒ¼ãƒˆã§ãã¾ã™ã€‚æ–‡å­—åˆ—ã‚’æ¸¡ã›ã°è¾žæ›¸é †ã«ã€‚


#### C. é›†è¨ˆé–¢æ•°ã¨ã®çµ„ã¿åˆã‚ã›ï¼šã‚¯ãƒ­ã‚¹é›†è¨ˆï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰

ã‚¯ãƒ­ã‚¹é›†è¨ˆã¯ã€**ã€Œè¡Œã€ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã€Œåˆ—ã€ã«å¤‰æ›**ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã™ã€‚ä¾‹ãˆã°ã€ã€Œæœˆã”ã¨ã®ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã€ã®ã‚ˆã†ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹éš›ã«éžå¸¸ã«å½¹ç«‹ã¡ã¾ã™ã€‚

##### Step 1: ãªãœã‚¯ãƒ­ã‚¹é›†è¨ˆãŒå¿…è¦ã‹ï¼Ÿï¼ˆå‹•æ©Ÿï¼‰

ã‚ãªãŸã¯ä¸Šå¸ã‹ã‚‰ã€Œ**æœˆã”ã¨ã«ã€é£Ÿå“ã€æ›¸ç±ã€å®¶é›»ã®å£²ä¸Šã‚’æ¯”è¼ƒã—ãŸã„**ã€ã¨ä¾é ¼ã•ã‚Œã¾ã—ãŸã€‚
ã¾ãšã€é€šå¸¸ã®`GROUP BY`ã§ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

**SQLã‚¯ã‚¨ãƒª (é€šå¸¸ã®GROUP BY)**
```sql
WITH sales AS (
  SELECT '2023-01-10'::date AS sale_date, 'é£Ÿå“' AS category, 1000 AS amount UNION ALL
  SELECT '2023-01-15'::date, 'æ›¸ç±', 2000 UNION ALL
  SELECT '2023-01-20'::date, 'é£Ÿå“', 1500 UNION ALL
  SELECT '2023-02-05'::date, 'å®¶é›»', 50000 UNION ALL
  SELECT '2023-02-12'::date, 'æ›¸ç±', 3000 UNION ALL
  SELECT '2023-02-18'::date, 'é£Ÿå“', 1200
)
SELECT
  TO_CHAR(sale_date, 'YYYY-MM') AS sale_month,
  category,
  SUM(amount) AS total_amount
FROM
  sales
GROUP BY
  sale_month,
  category
ORDER BY
  sale_month,
  category;
```

**å®Ÿè¡Œçµæžœ (ç¸¦é•·ã®ãƒ‡ãƒ¼ã‚¿)**

| sale_month | category | total_amount |
|:---|:---|:---|
| 2023-01 | æ›¸ç± | 2000 |
| 2023-01 | é£Ÿå“ | 2500 |
| 2023-02 | å®¶é›» | 50000 |
| 2023-02 | æ›¸ç± | 3000 |
| 2023-02 | é£Ÿå“ | 1200 |

ã“ã®çµæžœã¯æ­£ã—ã„ã§ã™ãŒã€æœˆã”ã¨ã®ã‚«ãƒ†ã‚´ãƒªå£²ä¸Šã‚’**ä¸€ç›®ã§æ¯”è¼ƒã™ã‚‹ã®ãŒé›£ã—ã„**ã§ã™ã€‚ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ã®ãŒã‚¯ãƒ­ã‚¹é›†è¨ˆã§ã™ã€‚

##### Step 2: ã‚¯ãƒ­ã‚¹é›†è¨ˆã®è€ƒãˆæ–¹

ã‚¯ãƒ­ã‚¹é›†è¨ˆã§ã¯ã€ä»¥ä¸‹ã®3ã¤ã®è¦ç´ ã‚’è€ƒãˆã¾ã™ã€‚
1.  **ä½•ã‚’è¡Œã®è»¸ã«ã™ã‚‹ã‹ï¼Ÿ** â†’ `GROUP BY`å¥ã§æŒ‡å®šã™ã‚‹åˆ—ï¼ˆä»Šå›žã¯ã€Œæœˆã€ï¼‰
2.  **ä½•ã‚’æ–°ã—ã„åˆ—ã«ã—ãŸã„ã‹ï¼Ÿ** â†’ `CASE`å¼ã§æ¡ä»¶åˆ†å²ã•ã›ã‚‹åˆ—ï¼ˆä»Šå›žã¯ã€Œã‚«ãƒ†ã‚´ãƒªã€ï¼‰
3.  **å„ã‚»ãƒ«ã§ä½•ã‚’è¨ˆç®—ã—ãŸã„ã‹ï¼Ÿ** â†’ é›†è¨ˆé–¢æ•°ï¼ˆ`SUM`, `COUNT`ãªã©ï¼‰ã§è¨ˆç®—ã™ã‚‹å€¤ï¼ˆä»Šå›žã¯ã€Œå£²ä¸Šé‡‘é¡ã€ï¼‰

##### Step 3: CASEå¼ã§ã‚¯ãƒ­ã‚¹é›†è¨ˆã‚’å®Ÿè£…ã™ã‚‹

ä¸Šè¨˜ã®è€ƒãˆæ–¹ã«åŸºã¥ãã€SQLã‚’ä½œæˆã—ã¾ã™ã€‚ã€Œã‚«ãƒ†ã‚´ãƒªã€ã®å„å€¤ã‚’`CASE`å¼ã§æ–°ã—ã„åˆ—ã«å¤‰æ›ã—ã€`SUM`é–¢æ•°ã§é›†è¨ˆã—ã¾ã™ã€‚

**SQLã‚¯ã‚¨ãƒª (ã‚¯ãƒ­ã‚¹é›†è¨ˆ)**
```sql
WITH sales AS (
  SELECT '2023-01-10'::date AS sale_date, 'é£Ÿå“' AS category, 1000 AS amount UNION ALL
  SELECT '2023-01-15'::date, 'æ›¸ç±', 2000 UNION ALL
  SELECT '2023-01-20'::date, 'é£Ÿå“', 1500 UNION ALL
  SELECT '2023-02-05'::date, 'å®¶é›»', 50000 UNION ALL
  SELECT '2023-02-12'::date, 'æ›¸ç±', 3000 UNION ALL
  SELECT '2023-02-18'::date, 'é£Ÿå“', 1200
)
SELECT
  TO_CHAR(sale_date, 'YYYY-MM') AS sale_month,
  -- categoryãŒ'é£Ÿå“'ã®è¡Œã ã‘amountã‚’åˆè¨ˆã—ã€ãã‚Œä»¥å¤–ã¯0ã‚’åˆè¨ˆã™ã‚‹
  SUM(CASE WHEN category = 'é£Ÿå“' THEN amount ELSE 0 END) AS food_sales,
  -- categoryãŒ'æ›¸ç±'ã®è¡Œã ã‘amountã‚’åˆè¨ˆã™ã‚‹
  SUM(CASE WHEN category = 'æ›¸ç±' THEN amount ELSE 0 END) AS book_sales,
  -- categoryãŒ'å®¶é›»'ã®è¡Œã ã‘amountã‚’åˆè¨ˆã™ã‚‹
  SUM(CASE WHEN category = 'å®¶é›»' THEN amount ELSE 0 END) AS electronics_sales
FROM
  sales
GROUP BY
  sale_month
ORDER BY
  sale_month;
```

**å®Ÿè¡Œçµæžœ (æ¨ªé•·ã®æ¯”è¼ƒã—ã‚„ã™ã„ãƒ‡ãƒ¼ã‚¿)**

| sale_month | food_sales | book_sales | electronics_sales |
|:---|:---|:---|:---|
| 2023-01 | 2500 | 2000 | 0 |
| 2023-02 | 1200 | 3000 | 50000 |

ã“ã®ã‚ˆã†ã«ã€ã‚«ãƒ†ã‚´ãƒªãŒåˆ—ã«ãªã‚Šã€æœˆã”ã¨ã®å£²ä¸Šæ¯”è¼ƒãŒæ ¼æ®µã«å®¹æ˜“ã«ãªã‚Šã¾ã—ãŸã€‚

**ðŸ’¡ PostgreSQLãªã‚‰ `FILTER` å¥ãŒã‚‚ã£ã¨ä¾¿åˆ©ï¼**
PostgreSQLã§ã¯ã€é›†è¨ˆé–¢æ•°ã«ç›´æŽ¥`FILTER`å¥ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šç›´æ„Ÿçš„ã‹ã¤ç°¡æ½”ã«åŒã˜å‡¦ç†ã‚’è¨˜è¿°ã§ãã¾ã™ã€‚

```sql
-- (WITHå¥ã¯ä¸Šè¨˜ã¨åŒã˜)
SELECT
  TO_CHAR(sale_date, 'YYYY-MM') AS sale_month,
  SUM(amount) FILTER (WHERE category = 'é£Ÿå“') AS food_sales,
  SUM(amount) FILTER (WHERE category = 'æ›¸ç±') AS book_sales,
  SUM(amount) FILTER (WHERE category = 'å®¶é›»') AS electronics_sales
FROM
  sales
GROUP BY
  sale_month
ORDER BY
  sale_month;
```



#### D. `WHERE`å¥ã§ã®åˆ©ç”¨ï¼šå‹•çš„ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° (âš ï¸æ³¨æ„ç‚¹ã‚ã‚Š)

`WHERE`å¥ã§CASEå¼ã‚’ä½¿ã†ã¨ã€æ¡ä»¶ã«ã‚ˆã£ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ãŒã€**ä¸€èˆ¬çš„ã«ã¯æŽ¨å¥¨ã•ã‚Œã¾ã›ã‚“**ã€‚

**ä¾‹4ï¼šä¼šå“¡ãƒ©ãƒ³ã‚¯ã«å¿œã˜ã¦è¡¨ç¤ºæ¡ä»¶ã‚’å¤‰æ›´ã™ã‚‹**
ã€Œã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡ã€ã¯å…¨å•†å“ã‚’è¡¨ç¤ºã—ã€ã€Œã‚·ãƒ«ãƒãƒ¼ä¼šå“¡ã€ã¯è³¼å…¥é‡‘é¡ãŒ3,000å††ä»¥ä¸Šã®å±¥æ­´ã®ã¿è¡¨ç¤ºã™ã‚‹ã€ã¨ã„ã†å‹•çš„ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚

**SQLã‚¯ã‚¨ãƒª (CASEå¼ - éžæŽ¨å¥¨)**
```sql
WITH customer_purchases AS (
  SELECT 'ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡' AS rank, 'å•†å“A' AS item, 5000 AS amount UNION ALL
  SELECT 'ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡', 'å•†å“B', 1000 UNION ALL
  SELECT 'ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡', 'å•†å“C', 4000 UNION ALL
  SELECT 'ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡', 'å•†å“D', 2000
)
SELECT
  rank, item, amount
FROM
  customer_purchases
WHERE
  CASE
    WHEN rank = 'ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡' THEN TRUE -- ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡ã¯å¸¸ã«è¡¨ç¤º
    WHEN rank = 'ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡' THEN amount >= 3000 -- ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡ã¯é‡‘é¡ã§ãƒ•ã‚£ãƒ«ã‚¿
    ELSE FALSE
  END;
```

â‡’whereå¥ã¯è¡Œã”ã¨ã«è©•ä¾¡ã•ã‚Œã‚‹ã®ã§ã—ãŸã­ï¼Ÿ
ã¾ãšã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡ã®è¡Œã¯å¸¸ã«TRUEãŒè¿”ã‚‹ãŸã‚ã€è¡¨ç¤ºå¯¾è±¡ã§ã™ã€‚
æ¬¡ã«ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡ã®è¡Œã¯é‡‘é¡ãŒ3000å††ä»¥ä¸Šã®å ´åˆTRUEãŒè¿”ã‚‹ãŸã‚ã€ãã®å ´åˆã¯è¡¨ç¤ºå¯¾è±¡ã§ã€ãã®ä»–ã¯è¡¨ç¤ºå¯¾è±¡å¤–ã§ã™ã€‚
æœ€å¾Œã«ãã®ä»–ã®è¡Œã¯å¸¸ã«FALSEãŒè¿”ã‚‹ã®ã§ã€è¡¨ç¤ºå¯¾è±¡å¤–ã§ã™ã€‚


**å®Ÿå‹™ä¸Šã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æŽ¨å¥¨ã•ã‚Œã‚‹æ›¸ãæ–¹**
`WHERE`å¥ã§ã®CASEå¼ã®ä½¿ç”¨ã¯ã€ã‚¯ã‚¨ãƒªã®**å¯èª­æ€§ã‚’è‘—ã—ãä½Žä¸‹**ã•ã›ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’åŠ¹çŽ‡çš„ã«åˆ©ç”¨ã§ããš**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãŒåŠ£åŒ–**ã™ã‚‹åŽŸå› ã¨ãªã‚‹ãŸã‚ã€é€šå¸¸ã¯é¿ã‘ã‚‹ã¹ãã§ã™ã€‚
ã“ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ã€`AND`ã¨`OR`ã‚’ä½¿ã£ãŸæ–¹ãŒã¯ã‚‹ã‹ã«æ˜Žç¢ºã§åŠ¹çŽ‡çš„ã§ã™ã€‚

**SQLã‚¯ã‚¨ãƒª (æŽ¨å¥¨)**
```sql
-- (WITHå¥ã¯ä¸Šè¨˜ã¨åŒã˜)
SELECT
  rank, item, amount
FROM
  customer_purchases
WHERE
  (rank = 'ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡')
  OR
  (rank = 'ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡' AND amount >= 3000);
```

**å®Ÿè¡Œçµæžœ (ã©ã¡ã‚‰ã®ã‚¯ã‚¨ãƒªã‚‚åŒã˜)**

| rank | item | amount |
|:---|:---|:---|
| ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡ | å•†å“A | 5000 |
| ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡ | å•†å“B | 1000 |
| ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡ | å•†å“C | 4000 |

**æ¡ä»¶å¼ãŒè¤‡é›‘ã«ãªã£ãŸä¾‹**
ä¸‹è¨˜ã©ã¡ã‚‰ã‚‚åŒã˜æ¡ä»¶ã§ã™ãŒã€èª­ã¿ã«ãã„ã§ã™ã‚ˆã­ã€‚ã€‚ã€‚

caseå¼ã‚’ä½¿ã£ãŸæ›¸ãæ–¹ï¼š
```SQL
-- ã©ã“ã‹ã‚‰ã©ã“ã¾ã§ãŒä¸€ã¤ã®æ¡ä»¶ã‹ã€éžå¸¸ã«åˆ†ã‹ã‚Šã«ãã„
WHERE
  CASE
    WHEN stock_quantity >= 100 THEN ( -- åœ¨åº«æ¡ä»¶
      CASE
        WHEN price > 500 THEN ( -- ä¾¡æ ¼æ¡ä»¶
          CASE
            WHEN category = 'å®¶é›»' THEN TRUE -- ã‚«ãƒ†ã‚´ãƒªæ¡ä»¶
            ELSE FALSE
          END
        )
        ELSE FALSE
      END
    )
    ELSE TRUE -- ãã‚Œä»¥å¤–ã¯ã™ã¹ã¦è¡¨ç¤º
  END;
```
æ™®é€šã®æ›¸ãæ–¹ï¼š
```SQL
-- æ¡ä»¶ãƒ–ãƒ­ãƒƒã‚¯ãŒæ˜Žç¢ºã§ã€è¿½åŠ ã‚„ä¿®æ­£ã‚‚å®¹æ˜“
WHERE
  (stock_quantity >= 100 AND price > 500 AND category = 'å®¶é›»')
  OR
  (stock_quantity < 100);
```
