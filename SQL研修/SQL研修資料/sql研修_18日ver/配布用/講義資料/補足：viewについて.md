### 1. PostgreSQLのビュー（VIEW）とは？

ビューとは、1つまたは複数のテーブルに対するSELECT文を保存し、仮想的なテーブルとして扱えるようにしたものです。 ビュー自体は実体としてのデータを持ちません。 ビューに対してクエリが実行されるたびに、定義されたSELECT文が実行され、結果が返されます。

#### ビューを利用するメリット

*   **複雑なクエリの単純化**: 複数のテーブルを結合したり、複雑な条件でデータを抽出したりするSELECT文をビューとして定義しておくことで、利用者は単純なSELECT文で目的のデータにアクセスできます。
*   **セキュリティの向上**: ユーザーごとにアクセスを許可するカラムや行を制限したビューを作成することで、元のテーブルへの直接アクセスを防ぎ、見せたい情報だけを公開できます。 例えば、個人情報を含むテーブルから氏名と所属部署のみを抽出したビューを作成し、一般ユーザーにはそのビューのみを公開するといった運用が可能です。
*   **データの独立性**: ビューを使用することで、テーブル構造の変更がアプリケーションに与える影響を最小限に抑えることができます。テーブルの変更に合わせてビューの定義を変更すれば、アプリケーション側の修正が不要になる場合があります。

#### ビューを利用する際の注意点

*   **パフォーマンス**: ビューは実行のたびに定義されたSELECT文が実行されるため、複雑なビューの場合はパフォーマンスが低下する可能性があります。
*   **更新の制約**: ビューに対する`INSERT`、`UPDATE`、`DELETE`といった更新処理には制約があります。一般的に、ビューが1つのテーブルから構成され、集約関数（`SUM`、`COUNT`など）や`GROUP BY`句を含まないなど、特定の条件を満たす場合にのみ更新可能です。

### 2. ビューの作り方

ビューの作成、更新、削除は簡単なSQL文で行うことができます。

#### 基本的な作成方法 (CREATE VIEW)

ビューを作成するには `CREATE VIEW` 文を使用します。

**構文:**
```sql
CREATE VIEW ビュー名 AS
SELECT カラム名1, カラム名2, ...
FROM テーブル名
WHERE 条件;
```

**具体例:**
`employees`（従業員）テーブルと `departments`（部署）テーブルがあるとします。

**`employees` テーブル:**

| id | name | department_id |
| :-- | :--- | :--- |
| 1 | 田中 | 1 |
| 2 | 鈴木 | 2 |
| 3 | 佐藤 | 1 |

**`departments` テーブル:**

| id | name |
| :-- | :--- |
| 1 | 営業部 |
| 2 | 開発部 |

これらのテーブルから、従業員名と部署名を取得する `employee_details` というビューを作成します。

```sql
CREATE VIEW employee_details AS
SELECT
    e.name AS employee_name,
    d.name AS department_name
FROM
    employees e
JOIN
    departments d ON e.department_id = d.id;
```

作成したビューは、通常のテーブルと同じように `SELECT` 文で利用できます。

```sql
SELECT * FROM employee_details;
```

**実行結果:**

| employee_name | department_name |
| :--- | :--- |
| 田中 | 営業部 |
| 佐藤 | 営業部 |
| 鈴木 | 開発部 |

#### ビューの更新・置換 (CREATE OR REPLACE VIEW)

既存のビューの定義を変更したい場合は、一度削除してから再作成するか、`CREATE OR REPLACE VIEW` 文を使用します。 このコマンドは、指定した名前のビューが存在しない場合は新規に作成し、存在する場合は置き換えます。

**構文:**
```sql
CREATE OR REPLACE VIEW ビュー名 AS
SELECT ... ;
```

#### ビューの削除 (DROP VIEW)

不要になったビューは `DROP VIEW` 文で削除します。

**構文:**
```sql
DROP VIEW ビュー名;
```

また、ビューが存在しない場合にエラーを出さずに実行したい場合は `IF EXISTS` を付けます。

```sql
DROP VIEW IF EXISTS ビュー名;
```

このように、ビューを適切に活用することで、データベースの運用をより効率的かつ安全に行うことができます。
