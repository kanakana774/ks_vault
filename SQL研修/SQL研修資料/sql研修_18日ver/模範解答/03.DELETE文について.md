EC サイトデータ DELETE 問題集

## 問題 1: 特定の商品を削除する

### 重要度: ★★★★

### 問題目的: DELETE 文と WHERE 句を用いて、特定の 1 つの行をテーブルから削除する基本的な方法を理解する。

### 問題: products_mst テーブルから、**「セラミックフライパン」**の情報を削除してください。

### 答え:

```SQL
DELETE FROM products_mst
WHERE product_name = 'セラミックフライパン';
```

備考：これも外部キー制約あるから、details テーブルから消さないとね、、、

## 問題 2: 在庫がゼロの商品を全て削除する

### 重要度: ★★★★★

### 問題目的: WHERE 句と比較演算子を用いて、条件に合致する複数の行を一括で削除する方法を理解する。

### 問題: products_mst テーブルから、在庫数(stock_quantity)が 0 個の商品を全て削除してください。

### 答え:

```SQL
DELETE FROM products_mst
WHERE stock_quantity = 0;
```

備考：これも外部キー制約あるから、details テーブルから消さないとね、、、

## 問題 3: 特定のカテゴリに属する商品をまとめて削除する

### 重要度: ★★★★

### 問題目的: WHERE 句でカテゴリを指定し、複数の関連する行をまとめて削除する方法を理解する。

### 問題: products_mst テーブルから、カテゴリ(category)が'Food'の全ての商品を削除してください。

### 答え:

```SQL
DELETE FROM products_mst
WHERE category = 'Food';
```

備考：これも外部キー制約あるから、details テーブルから消さないとね、、、

## 問題 4: 長期間利用がない顧客を削除する

### 重要度: ★★★★★

### 問題目的: 日付型の列と日付比較を用いて、古いデータを削除する方法を理解する。

### 問題: customers_mst テーブルから、2023 年 3 月 1 日より前に登録された顧客の情報を削除してください。

### 答え:

```SQL
DELETE FROM customers_mst
WHERE created_date < '2023-03-01';
```

備考：これも外部キー制約あるから、orders テーブルと details テーブルから消さないとね、、、

## 問題 5: メモが設定されていない商品を削除する

### 重要度: ★★★★

### 問題目的: IS NULL 演算子を使って、NULL 値を持つ行を対象に削除を行う方法を理解する。

### 問題: products_mst テーブルから、メモ(memo)が NULL である商品を全て削除してください。

### 答え:

```SQL
DELETE FROM products_mst
WHERE memo IS NULL;
```

## 問題 6: 特定の顧客 ID に関連する注文明細と注文を削除する

### 重要度: ★★★★★

### 問題目的: 外部キー制約のあるテーブルでデータを削除する際の順序を理解する。親テーブルのレコードを削除する前に子テーブルのレコードを削除する必要があることを学ぶ。

### 問題: customer_id が 4 の顧客（山田 恵美）が、これまでに購入した全ての注文明細と、その顧客に関連する全ての注文情報をデータベースから削除してください。

ヒント: 外部キー制約により、orders_trn のレコードを削除する前に、まずそれに関連する order_details_trn のレコードを削除する必要があります。

### 答え:

```SQL
-- 1. まず、削除対象の顧客に関連する注文の order_id を取得する（確認用）
SELECT order_id
FROM orders_trn
WHERE customer_id = 4;
-- 例: order_id = 5 が該当すると仮定

-- 2. 次に、取得した order_id に紐づく注文明細（order_details_trn）を削除
DELETE FROM order_details_trn
WHERE order_id IN (SELECT order_id FROM orders_trn WHERE customer_id = 4);
-- サブクエリはやってないので、実際には下記を想定
-- DELETE FROM order_details_trn WHERE order_id = 5（特定したorder_id）;

-- 3. 最後に、対象の顧客の注文（orders_trn）を削除
DELETE FROM orders_trn
WHERE customer_id = 4;
```

補足: この問題は、外部キー制約が設定されているテーブルで削除操作を行う際の重要な考慮点を示しています。実務では、ON DELETE CASCADE のような外部キーオプションを設定することで、親レコードの削除時に子レコードも自動的に削除するよう設定できますが、意図しないデータ削除を防ぐためには、手動での削除順序を理解することも重要です。

## 問題 7: 【極めて危険！】 全ての注文データを削除する

### 重要度: ★★★★★

### 問題目的: WHERE 句を付けずに DELETE 文を実行した場合、テーブル全ての行が削除されてしまうことを理解し、その極めて高い危険性を認識する。

### 問題: orders_trn テーブルの全ての注文情報を削除してください。

警告: この操作はテーブルの全てのデータに影響を与えます。実務環境では絶対に行わないでください。この問題は WHERE 句の重要性と、DELETE の破壊的な側面を理解するためのものです。

### 答え:

```SQL
DELETE FROM orders_trn; -- WHERE 句がないため、全ての行が削除される
```

備考：これも外部キー制約あるから、details テーブルから消さないとね、、、

補足: この問題は、UPDATE と同様に WHERE 句の指定を忘れた場合に何が起こるかを示すためのものです。本番環境での DELETE 文は、常に WHERE 句で削除対象を絞り込むことを徹底し、実行前には必ず内容を確認することが必要です。また、レビュー時に併せて論理削除についても教えること。
