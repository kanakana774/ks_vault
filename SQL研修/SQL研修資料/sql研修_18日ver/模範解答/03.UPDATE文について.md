EC サイトデータ UPDATE 問題集

## 問題 1: 特定商品の価格を変更する

### 重要度: ★★★★

### 問題目的: UPDATE 文と WHERE 句を用いて、特定の 1 つの行の特定の列の値を更新する基本的な方法を理解する。

### 問題: products_mst テーブルの**「ワイヤレスイヤホン」**の価格を、現在の 12800.00 円から 11980.00 円に更新してください。

### 答え:

```SQL
UPDATE products_mst
SET price = 11980.00
WHERE product_name = 'ワイヤレスイヤホン';
```

## 問題 2: 複数の情報を同時に更新する

### 重要度: ★★★★★

### 問題目的: 1 つの UPDATE 文で複数の列の値を同時に更新する方法を理解する。

### 問題: products_mst テーブルの**「SQL 入門」**について、以下の 2 つの情報を更新してください。

価格を 2200.00 円に変更する。
在庫数を 180 個に変更する。

### 答え:

```SQL
UPDATE products_mst
SET price = 2200.00, stock_quantity = 180
WHERE product_name = 'SQL 入門';
```

## 問題 3: 在庫数に基づいて商品の価格を割引する

### 重要度: ★★★★★

### 問題目的: 既存の列の値を参照して計算し、その結果で列を更新する方法を理解する。

### 問題: products_mst テーブルで、在庫数(stock_quantity)が 200 個以上ある商品の価格を 10%割引してください。

### 答え:

```SQL
UPDATE products_mst
SET price = price * 0.9
WHERE stock_quantity >= 200;
```

### バリエーション:

```SQL
price = price * 0.90 や price = price * (price - 0.10) など、計算方法は複数考えられます。
```

## 問題 4: 特定カテゴリの商品のメモを更新する

### 重要度: ★★★★

### 問題目的: WHERE 句でカテゴリを指定し、複数の行を一括で更新する方法を理解する。また、TEXT 型の列の更新も行う。

### 問題: products_mst テーブルで、カテゴリ(category)が'Books'の全ての商品のメモ欄を'人気書籍'に更新してください。

### 答え:

```SQL
UPDATE products_mst
SET memo = '人気書籍'
WHERE category = 'Books';
```

## 問題 5: 登録日が古い顧客のメールアドレスを更新する（条件の組み合わせ）

### 重要度: ★★★★★

### 問題目的: WHERE 句で複数の条件（日付比較と論理演算子）を組み合わせて、更新対象を絞り込む方法を理解する。

### 問題: customers_mst テーブルで、2023 年 4 月 1 日より前に登録された顧客のメールアドレスのドメインを@example.com から@newcompany.com に変更してください。（例: sato.taro@example.com → sato.taro@newcompany.com）

### 答え:

```SQL
UPDATE customers_mst
SET email = REPLACE(email, '@example.com', '@newcompany.com')
WHERE created_date < '2023-04-01';
```

補足: REPLACE 関数は PostgreSQL の文字列操作関数です。email 列の値から特定の文字列を検索し、別の文字列に置き換えます。

## 問題 6: 特定の顧客の最近の注文日を更新する

### 重要度: ★★★★★

### 問題目的: 特定の顧客 ID に紐づく注文の中で、最新の注文日を更新する（ただし、この段階ではサブクエリは使わない）。

### 問題: orders_trn テーブルで、customer_id が 1 の顧客（佐藤 太郎）の最も新しい注文日を 2023-08-30 に更新してください。

ヒント: まず customer_id=1 の最新の order_date を持つ order_id を特定し、その order_id を使って更新します。

### 答え:

```SQL
-- 1. まず、customer_id=1 の最も新しい注文日を持つ order_id を確認する (SELECT 文で確認)
SELECT order_id, order_date
FROM orders_trn
WHERE customer_id = 1
ORDER BY order_date DESC
LIMIT 1;
-- limitはここでやってないので、実際にはlimitを省略した上記クエリから、一番上のレコードを確認する手順になるかも

-- 例えば、上記で order_id が 8 と判明した場合の更新クエリ
UPDATE orders_trn
SET order_date = '2023-08-30'
WHERE order_id = 8;
```

補足: この問題は、実務でよく遭遇する「特定の条件に合致する 1 件（または数件）のレコードを特定し、そのレコードを更新する」というシナリオをシミュレートしています。SELECT で確認し、その結果を使って UPDATE をかけるという流れです。後にサブクエリを勉強するとここらへんを一つの処理で書けるようになる。

## 問題 7: メモが NULL の商品にデフォルト値を設定する

### 重要度: ★★★★

### 問題目的: IS NULL 演算子を使って、NULL 値を持つ行を対象に更新を行う方法を理解する。

### 問題: products_mst テーブルで、メモ(memo)が NULL である商品のメモ欄を、'詳細未設定'という文字列に更新してください。

### 答え:

```SQL
UPDATE products_mst
SET memo = '詳細未設定'
WHERE memo IS NULL;
```

## 問題 8: 売れ残りの可能性のある商品の在庫をゼロにする

### 重要度: ★★★★★

### 問題目的: 複数の WHERE 条件を AND で組み合わせ、特定のシナリオ（価格が安く、かつ在庫が残っている商品）で一括更新を行う。

### 問題: products_mst テーブルで、価格が 2000 円未満で、かつ在庫数が 0 より大きい（売れ残っている）商品の在庫数(stock_quantity)を 0 に設定してください。

### 答え:

```SQL
UPDATE products_mst
SET stock_quantity = 0
WHERE price < 2000 AND stock_quantity > 0;
```

## 問題 9: 論理削除

### 重要度: ★★★★★

### 問題目的: 論理削除してみる

### 問題: products_mst テーブルで product_id が 1 の商品を論理削除してください。

### 答え:

```SQL
UPDATE PRODUCTS_MST
SET
	DELETED_AT = NOW()
WHERE
	PRODUCT_ID = 1;
```

## 問題 10: 【危険！】 全ての商品価格をゼロにする

### 重要度: ★★★★★

### 問題目的: WHERE 句を付けずに UPDATE 文を実行した場合、テーブル全ての行が更新されてしまうことを理解し、その危険性を認識する。

### 問題: products_mst テーブルの全ての商品の価格を 0.00 円に更新してください。

警告: この操作はテーブルの全てのデータに影響を与えます。実務環境では絶対に行わないでください。この問題は WHERE 句の重要性を理解するためのものです。

### 答え:

```SQL
UPDATE products_mst
SET price = 0.00; -- WHERE 句がないため、全ての行が更新される
```

補足: この問題は、WHERE 句の指定を忘れた場合に何が起こるかを示すためのものです。本番環境での UPDATE 文は、常に WHERE 句で更新対象を絞り込むことを徹底する必要があります。
これらの追加問題は、UPDATE 文の柔軟性と、WHERE 句の条件指定の重要性をより深く学べるように設計しました。特に最後の問題は、実務での UPDATE 操作がいかに慎重に行われるべきかを学ぶ上で非常に重要です。
次にどのようなテーマの問題を作成しましょうか？DELETE や ALTER TABLE、または結合（JOIN）など、ご希望のテーマがあれば教えてください！
