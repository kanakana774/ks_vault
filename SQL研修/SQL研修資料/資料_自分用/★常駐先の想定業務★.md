
# SQLを中心とした開発現場（SES案件）の全体像

## 🧱 1. 業務システム系（最も多いパターン）⇒★

### 主な仕事
- 業務システム（販売管理・会計・物流など）の**データ抽出・加工・集計処理**をSQLで実装。
- **View、Stored Procedure、Function**を作成・改修。
- **夜間バッチ処理**や**帳票出力用SQL**の調整。
- **障害調査・原因分析**でSQLを用いてデータ追跡。

### よく使う技術
- SQL（Oracle / PostgreSQL / SQL Server / MySQL）
- PL/SQL（Oracle）、T-SQL（SQL Server）
- Shell / Python / JavaなどでのSQLバッチ実行
- BIツール連携（Tableau, Power BIなど）

### よくあるタスク例
| タスク | 内容 |
|--------|------|
| データ抽出 | 月次売上や支店別集計のクエリを作成 |
| 更新SQL | 条件に合致する顧客情報の一括更新 |
| SQLレビュー | クエリロジックや性能を検証 |
| チューニング | インデックス追加やEXPLAIN分析 |
| データ移行 | システム間データ変換・登録処理 |

---

### 🔷 PL/SQLとは？

**PL/SQL（Procedural Language / SQL）** は、Oracle Databaseに組み込まれた**手続き型言語**です。  
SQLに「変数・条件分岐・ループ・例外処理」などの構造を加え、**1件1件のSQLでは表現しきれない業務処理をまとめて実装できる**ようにしたものです。

👉 PostgreSQL では同様の仕組みが **PL/pgSQL**  
👉 SQL Server では **T-SQL**  
👉 MySQL では **ストアドプロシージャ言語**  
という具合に、各DBが独自の“手続き型SQL”を持っています。


### 🔶 どんな場面で使われるのか

業務システムでPL/SQLが使われる典型的な場面を挙げます。

|用途|具体例|ポイント|
|---|---|---|
|**バッチ処理**|1日の終わりに在庫数を集計して更新する|大量データをDB内で一括処理できる|
|**データ整合性チェック**|登録時に在庫マイナス禁止などのチェック|Javaなどアプリ層よりも高速・確実|
|**トリガー処理**|注文登録時に出荷指示テーブルへ自動登録|イベント駆動で裏処理を実行|
|**共通関数化**|日付フォーマットや税額計算を共通関数に|アプリ・他SQLから再利用可能|
|**インタフェース処理**|他システム用に一時テーブルへデータ作成|外部連携やバッチ連携向け|


### 🔷 例：売上集計を行うPL/SQL

```sql
CREATE OR REPLACE PROCEDURE daily_sales_aggregation IS
    v_total NUMBER := 0;
BEGIN
    -- 当日の売上を集計
    SELECT SUM(amount)
      INTO v_total
      FROM sales
     WHERE sale_date = TRUNC(SYSDATE);

    -- 集計結果を履歴テーブルに登録
    INSERT INTO sales_summary (summary_date, total_amount)
    VALUES (TRUNC(SYSDATE), v_total);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        INSERT INTO error_log(message, log_date)
        VALUES (SQLERRM, SYSDATE);
END;
/
```

このようにPL/SQLでは：

- `DECLARE` … 変数定義
    
- `BEGIN ... END` … 処理ブロック
    
- `EXCEPTION` … 例外処理  
    が書けるため、アプリでやるような一連のロジックをDB内で完結できます。
    

---

### 🔶 なぜ業務系で多く使われるのか？

1. **データ量が多くても高速**（ネットワーク転送なしでDB内処理）
    
2. **業務ルールの一元管理**（複数アプリから共通利用）
    
3. **信頼性・整合性の担保**（DBトランザクション内で完結）
    
4. **夜間バッチなど運用が安定**（ジョブスケジューラから直接実行可能）
    

そのため、大手企業の基幹系（販売・在庫・会計など）では、  
「Java + Oracle + PL/SQL」の組み合わせが今でも主流です。


### 🔷 ただし、近年の流れ

最近はアプリ層（Spring Bootなど）でロジックを持つ設計も増えています。  
理由は：

- DB依存を減らし、移行（例：Oracle→PostgreSQL）を容易にするため
- DevOpsやテスト自動化との相性をよくするため

とはいえ、**集計・一括更新・帳票系のバッチ処理**では、  
今もPL/SQL（あるいはPL/pgSQL）は多用されています。


### 🔹まとめ

|観点|PL/SQLの特徴|
|---|---|
|性能|DB内で完結するため高速|
|保守|SQL中心でDB依存が高い|
|適用領域|バッチ・集計・検証・補助業務ロジック|
|近年の傾向|複雑なロジックはアプリ層（Java等）に移行、ただしDB内バッチでは健在|


---

## 🧾 2. データ分析／DWH系（データエンジニア寄り）

### 主な仕事
- 各システムから収集したデータを**DWH（データウェアハウス）**に格納。
- **分析用ビューや集計テーブル**を設計・作成。
- **ETL処理**をSQLで構築（Extract / Transform / Load）。

### よく使う技術
- BigQuery / Snowflake / Redshift / Hive / SparkSQL
- Airflow / Digdag / dbt などのジョブ管理ツール
- GitでSQLモジュールをコード管理

### よくあるタスク例
- 顧客360°ビュー作成（複数システムのJOIN）
- データマート更新ジョブ管理
- 分析指標やロジックの追加・修正

---

## 🏭 3. バッチシステム系（Spring Batch / Shell + SQL）

### 主な仕事
- RDB間でのデータ転送・加工を行う**定期バッチ開発**。
- Java + MyBatisなどで**SQLを呼び出し業務ロジックを実装**。
- テーブル構造や更新順序の設計。

### よく使う技術
- Spring Batch / MyBatis / JDBC
- PostgreSQL / Oracle
- JP1, Systemwalkerなどのジョブ管理ツール

### よくあるタスク例
- 「受注 → 出荷指示 → 出荷確定」の夜間バッチ処理
- トランザクション制御・ロールバック対応
- バッチ性能改善（クエリ分割・バルク更新）

---

## ⚙️ 4. アプリ連携・APIバックエンドの裏側

### 主な仕事
- REST APIの内部で**MyBatisやJPAを使ってSQLを設計・実装**。
- SQL性能を最適化してAPIレスポンスを改善。

### 例
```sql
SELECT user_id, SUM(amount)
FROM payments
WHERE payment_date BETWEEN :from AND :to
GROUP BY user_id;
```

→ MyBatis Mapperに組み込み、Javaコードから呼び出し。

---

## 🎯 現場で求められるスキル

|カテゴリ|スキル内容|
|---|---|
|SQL構文|SELECT / JOIN / GROUP BY / サブクエリ / CASE|
|パフォーマンス|インデックス設計、実行計画（EXPLAIN）の読解|
|データモデリング|正規化、ER図、主従関係の理解|
|トランザクション制御|COMMIT単位、排他制御|
|障害調査|データ不整合や件数差異の原因特定|

---

## 💬 SES案件としての特徴

- **業務担当者との連携が多い**（仕様確認・抽出条件相談など）。
    
- 新規開発よりも**保守・改修・運用対応**が中心。
    
- **既存SQLの解析・修正・チューニング**の比率が高い。
    
- 開発スピードよりも**正確性と検証力**が重視される。
    

---

## 🔍 まとめ

|項目|内容|
|---|---|
|主な目的|データ加工・集計・連携|
|主な成果物|SQLスクリプト、ビュー、ストアド、ETLジョブ|
|関連領域|業務システム、DWH、バッチ、API|
|成長方向|データエンジニア／バッチエンジニア／業務SE|

---

> 💡 **補足**  
> SQL中心の現場は「地味だが本質的」な世界です。  
> データ構造や業務ロジックを理解し、チューニングや調査力を磨くと  
> アプリ側・分析側のどちらにもキャリア展開しやすい分野です。