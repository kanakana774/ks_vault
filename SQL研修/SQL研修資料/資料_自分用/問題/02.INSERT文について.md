EC サイトデータ INSERT 問題集

## 問題 1: 全ての情報を指定して新しい顧客を登録する

### 重要度: ★★★★

### 問題目的: INSERT INTO テーブル名 VALUES (...) を使用して、テーブルの全ての列に値を指定して新しい行を追加する方法を理解する。SERIAL 型（customer_id）は自動採番されるため、INSERT 文で指定する必要がないことを確認する。

### 問題: customers_mst テーブルに、以下の情報を全て指定して新しい顧客「杉山 陽子」（メールアドレス: sugiyama.yoko@example.com、登録日: 2024-01-10）を登録してください。

### 答え:

```SQL
INSERT INTO customers_mst (customer_name, email, created_date)
VALUES ('杉山 陽子', 'sugiyama.yoko@example.com', '2024-01-10');
```

補足: customer_id は SERIAL 型なので自動採番されます。

## 問題 2: 必須項目のみ指定して新しい商品を登録する

### 重要度: ★★★★★

### 問題目的: INSERT INTO テーブル名 (列名 1, 列名 2, ...) VALUES (値 1, 値 2, ...) を使用して、特定の列にのみ値を指定して新しい行を追加する方法を理解する。DEFAULT 値が設定される列（stock_quantity）や、NULL が許可されている列（memo）の挙動を確認する。

### 問題: products_mst テーブルに、以下の情報を指定して新しい商品「ワイヤレス充電器」（カテゴリ: Electronics、価格: 3500.00）を登録してください。在庫数とメモは指定しないでください。

※追記：在庫数に初期値がないので在庫数も指定することに

### 答え:

```SQL
INSERT INTO products_mst (category, product_name, price, stock_quantity)
VALUES ('Electronics', 'ワイヤレス充電器', 3500.00, 0);
```

補足: memo には NULL が自動的に設定されます。

## 問題 3: 特定の注文に新しい注文明細を追加する

### 重要度: ★★★★★

### 問題目的: 複合主キーを持つテーブルへの INSERT 方法を理解し、既存の order_id と product_id の組み合わせが重複しないように注意する。

### 問題: 既存の orders_trn の order_id が 1 の注文に、新しい注文明細として product_id が 15 の商品を 3 個追加してください。

### 答え:

```SQL
INSERT INTO order_details_trn (order_id, product_id, quantity)
VALUES (1, 15, 3);
```

補足: この操作により、佐藤 太郎氏の 1 回目の注文（order_id=1）に、「国産はちみつ」が追加されます。もし order_id=1 と product_id=15 の組み合わせが既に存在する場合、主キー制約違反のエラーが発生します。

## 問題 4: 注文と注文明細を同時に登録するシナリオを考える

### 重要度: ★★★★★

### 問題目的: 関連する複数のテーブルにデータを挿入する際の順序と外部キー制約の理解を促す。実際には INSERT 文は複数になることを体験する。

### 問題: customer_id が 2 の顧客（鈴木 花子）が、2024-02-01 に「電気ケトル」（product_id=3）を 1 個、および「高級チョコレートアソート」（product_id=10）を 2 個購入する注文を登録してください。

ヒント: まず orders_trn に注文を登録し、その order_id を使用して order_details_trn に明細を登録する必要があります。PostgreSQL では RETURNING 句を使って新しく生成された order_id を取得できます。

### 答え:

```SQL
-- 1. まず orders_trn に新しい注文を登録し、生成された order_id を取得
INSERT INTO orders_trn (customer_id, order_date)
VALUES (2, '2024-02-01')
RETURNING order_id; -- この実行で order_id が返されます。例: 12
-- ※RETURNINGは使用せずに、作成したorderIdをSELECTで確かめる手順でもよい。

-- 2. 取得した order_id (例: 12) を使用して order_details_trn に明細を登録
-- ここでは便宜的に order_id を 12 と仮定します。実際には上のクエリ実行結果を元にしてください。
INSERT INTO order_details_trn (order_id, product_id, quantity)
VALUES (12, 3, 1); -- 電気ケトルを 1 個

INSERT INTO order_details_trn (order_id, product_id, quantity)
VALUES (12, 10, 2); -- 高級チョコレートアソートを 2 個
```

補足: RETURNING order_id は PostgreSQL 固有の便利な機能です。他の RDBMS では、シーケンスを使った値の取得や、SCOPE_IDENTITY()（SQL Server）、LAST_INSERT_ID()（MySQL）など、異なる方法で新しく生成された ID を取得します。実務ではアプリケーション側でこれらの ID を連携して次の INSERT を行うことになります。
