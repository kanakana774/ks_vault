# 標準課題（別解や注意）

## 問題 1：
各顧客の名前と、所属している会員ランクの名前をCUSTOMER_IDの昇順取得してください。
ただし、会員ランクが未設定のユーザーは「NoRank」と表示するようにしてください。



```SQL
SELECT
	C.CUSTOMER_ID,
	C.NAME AS CUSTOMER_NAME,
	COALESCE(M.RANK_NAME, 'NoRank')
FROM
	CUSTOMERS C
	LEFT OUTER JOIN MEMBERSHIPS M ON C.MEMBERSHIP_ID = M.MEMBERSHIP_ID
ORDER BY
	C.CUSTOMER_ID;
```

別解
```SQL
-- caseを使った回答もありました
SELECT
   c.customer_id,
   name 顧客名,
   CASE
      WHEN rank_name IS NULL THEN 'NoRank'
      ELSE rank_name
   END 会員ランク名
FROM
   customers c
   LEFT OUTER JOIN memberships m　ON　c.membership_id =m.membership_id
ORDER BY
   c.customer_id;
```

また全体的に、内部結合ですべきか外部結合ですべきか問題から読み取りづらかったため、その辺の判定を緩くしてる。
## 問題2
全ての商品について、商品名とカテゴリ名を取得してください。

```SQL
SELECT
	P.PRODUCT_ID,
	P.PRODUCT_NAME,
	C.CATEGORY_NAME
FROM
	PRODUCTS P
	INNER JOIN CATEGORIES C ON P.CATEGORY_ID = C.CATEGORY_ID;
```

## 問題3
すべての注文について、注文ID・注文日・顧客名を取得してください。
ただし、顧客名はcustomer_nameという別名で表示してください。

```SQL
SELECT
	O.ORDER_ID,
	O.ORDER_DATE,
	C.NAME AS CUSTOMER_NAME
FROM
	ORDERS O
	INNER JOIN CUSTOMERS C ON O.CUSTOMER_ID = C.CUSTOMER_ID;
```

## 問題4
各注文明細ごとに、注文ID・商品名・数量・単価・商品ごとの合計金額を取得してください。

```SQL
SELECT
	OI.ORDER_ID,
	P.PRODUCT_NAME,
	OI.QUANTITY,
	P.PRICE,
	(OI.QUANTITY * P.PRICE) AS TOTAL_AMOUNT
FROM
	ORDERITEMS OI
	INNER JOIN PRODUCTS P ON OI.PRODUCT_ID = P.PRODUCT_ID;
```

## 問題5
すべての注文について、注文ID・顧客名・支払金額・配送状況を取得してください。
支払金額にはpayment_amount、配送状況shipment_statusという別名をつけてください。
ただし、支払いをしていないユーザーの支払金額は0と表示するようにしてください。
また、配送が完了していないユーザーの配送状況はNotDeliveredと表示するようにしてください。

```SQL
SELECT
	O.ORDER_ID,
	C.NAME AS CUSTOMER_NAME,
	COALESCE(P.AMOUNT, 0) AS PAYMENT_AMOUNT,
	COALESCE(S.STATUS, 'NotDelivered') AS SHIPMENT_STATUS
FROM
	ORDERS O
	INNER JOIN CUSTOMERS C ON O.CUSTOMER_ID = C.CUSTOMER_ID
	LEFT OUTER JOIN PAYMENTS P ON O.ORDER_ID = P.ORDER_ID
	LEFT OUTER JOIN SHIPMENTS S ON O.ORDER_ID = S.ORDER_ID;
```



---

# 追加課題

## 問題の目的

複数のテーブルを適切に結合し、特定の条件に基づいてデータを抽出する能力を養います。INNER JOIN, LEFT JOIN (または LEFT OUTER JOIN), RIGHT JOIN (または RIGHT OUTER JOIN)、FULL JOIN (または FULL OUTER JOIN) を使い分け、NULL 値の扱いや、結合されたデータから情報を取得する方法を理解することを目的とします。

## 問題：顧客情報と注文数の取得

すべての顧客について、顧客名と、その顧客が行った注文の総数を取得してください。注文が一度もない顧客も表示してください。
結果は顧客名で昇順に並べてください。

## 解答

1. 顧客情報と注文数の取得

   ```SQL
   SELECT
    c.name AS customer_name,
    COUNT(o.order_id) AS total_orders
   FROM
    Customers AS c
   LEFT JOIN
    Orders AS o ON c.customer_id = o.customer_id
   GROUP BY
    c.customer_id, c.name
   ORDER BY
    c.name;
   ```

## 問題：カテゴリごとの商品と在庫状況

すべての商品カテゴリについて、そのカテゴリに属する商品名、価格、および各商品の在庫がある倉庫名と在庫数を取得してください。
在庫がない商品も表示し、その場合は倉庫名と在庫数を NULL としてください。
結果はカテゴリ名、商品名で昇順に並べてください。

2. カテゴリごとの商品と在庫状況
   ```SQL
   SELECT
    ca.category_name,
    p.product_name,
    p.price,
    w.warehouse_name,
    i.stock_quantity
   FROM
    Categories AS ca
   JOIN
    Products AS p ON ca.category_id = p.category_id
   LEFT JOIN
    Inventory AS i ON p.product_id = i.product_id
   LEFT JOIN
    Warehouses AS w ON i.warehouse_id = w.warehouse_id
   ORDER BY
    ca.category_name, p.product_name;
   ```

## 問題：各倉庫のスタッフと担当商品の情報

各倉庫に所属するスタッフの名前と役職、そのスタッフが担当する倉庫にある商品の名前と在庫数を取得してください。
スタッフが所属する倉庫に商品が一つもない場合も、スタッフの名前と役職は表示してください。
倉庫にスタッフが一人もいない場合も、商品名と在庫数は表示してください。
結果は倉庫名、スタッフ名、商品名で昇順に並べてください。

3. 各倉庫のスタッフと担当商品の情報

```SQL
SELECT
 w.warehouse_name,
 s.name AS staff_name,
 s.position,
 p.product_name,
 i.stock_quantity
FROM
 Warehouses AS w
LEFT JOIN
 Staff AS s ON w.warehouse_id = s.warehouse_id
LEFT JOIN
 Inventory AS i ON w.warehouse_id = i.warehouse_id
LEFT JOIN
 Products AS p ON i.product_id = p.product_id
ORDER BY
 w.warehouse_name, s.name, p.product_name;
```

## 問題：顧客の注文と配送状況（配送なしも含む）

すべての顧客について、顧客名、注文日、注文ステータス、およびその注文の配送状況（delivery_date, status）を取得してください。
配送がまだ行われていない注文（Shipments テーブルに該当するレコードがない注文）も表示し、その場合は配送に関する情報（shipped_date, delivery_date, status）を NULL としてください。
結果は顧客名、注文日で昇順に並べてください。

4. 顧客の注文と配送状況（配送なしも含む）

   ```SQL
   SELECT
    c.name AS customer_name,
    o.order_date,
    o.status AS order_status,
    s.shipped_date,
    s.delivery_date,
    s.status AS shipment_status
   FROM
    Customers AS c
   JOIN
    Orders AS o ON c.customer_id = o.customer_id
   LEFT JOIN
    Shipments AS s ON o.order_id = s.order_id
   ORDER BY
    c.name, o.order_date;
   ```

## 問題：レビューが投稿されていない商品とレビューがある商品の平均評価

すべての商品について、商品名と、その商品に投稿されたレビューの平均評価を取得してください。
レビューが一つも投稿されていない商品も表示し、その場合は平均評価を NULL としてください。
平均評価は小数点以下 2 桁まで表示してください。
結果は商品名で昇順に並べてください。

5. レビューが投稿されていない商品とレビューがある商品の平均評価

```SQL
SELECT
 p.product_name,
 ROUND(AVG(r.rating), 2) AS average_rating
FROM
 Products AS p
LEFT JOIN
 Reviews AS r ON p.product_id = r.product_id
GROUP BY
 p.product_id, p.product_name
ORDER BY
 p.product_name;
```
