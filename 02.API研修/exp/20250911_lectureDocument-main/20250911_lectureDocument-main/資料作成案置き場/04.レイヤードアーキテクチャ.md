## レイヤードアーキテクチャの説明資料

### 1. レイヤードアーキテクチャとは？

レイヤードアーキテクチャは、ソフトウェアの設計パターンの一つで、システムを機能ごとに階層（レイヤー）に分割して構築する手法です。各レイヤーは特定の役割を持ち、上位のレイヤーは下位のレイヤーの機能を利用しますが、下位のレイヤーは上位のレイヤーの存在を知りません。これにより、各レイヤーが独立性を保ち、変更や保守が容易になります。

<img src="レイヤードアーキテクチャ概念図.png" width="80%"><br>
概念図（３層バージョン）<br>
参照元：https://zenn.dev/tsutani2828/articles/layeredarchitecture

**主な目的:**

- **関心事の分離 (Separation of Concerns):** 各レイヤーが特定の責任を持つことで、役割が明確になります。
- **保守性の向上:** 特定のレイヤーの変更が、他のレイヤーに与える影響を最小限に抑えます。
- **テストの容易性:** 各レイヤーを独立してテストできます。
- **再利用性:** 特定のレイヤーのコンポーネントを他の部分で再利用しやすくなります。

---

### 2. 一般的な 4 層レイヤードアーキテクチャ

最も一般的なレイヤードアーキテクチャは、以下の 4 つのレイヤーで構成されます。

#### ① プレゼンテーション層 (Presentation Layer / UI Layer)

ユーザーインターフェース（UI）を担当する層です。ユーザーからの入力（クリック、キー入力など）を受け取り、それをアプリケーション層に伝えます。また、アプリケーション層から受け取った情報をユーザーに表示します。

- **役割:** ユーザーインターフェースの描画、ユーザー入力の処理
- **例:** Web ブラウザの HTML/CSS/JavaScript、デスクトップアプリケーションの GUI コンポーネント、モバイルアプリの画面

#### ② アプリケーション層 (Application Layer)

ビジネスロジックの調整役となる層です。プレゼンテーション層からの要求を受け取り、ドメイン層やインフラストラクチャ層のサービスを組み合わせてビジネスプロセスを実行します。自身ではビジネスルールを持ちません。

- **役割:** ユーザー要求の解釈、ビジネスプロセス（ユースケース）の実行、トランザクション管理、複数のドメインエンティティやサービス間の調整
- **例:** ユーザー登録処理のフロー、商品購入処理のフロー

#### ③ ドメイン層 (Domain Layer)

システムの核となるビジネスロジックとビジネスルールを実装する層です。エンティティ、値オブジェクト、集約、ドメインサービス、リポジトリインターフェースなどが含まれます。この層は、特定の技術実装（データベースや Web フレームワークなど）に依存しません。

- **役割:** 中核となるビジネスロジックとデータのカプセル化、ビジネスルールの適用
- **例:** 顧客エンティティとそのメソッド（例: 顧客情報の更新）、商品の在庫管理ルール、注文の合計金額計算ロジック

#### ④ インフラストラクチャ層 (Infrastructure Layer)

永続化（データベース）、ネットワーク通信、ファイル I/O、外部 API 連携など、技術的な詳細を扱う層です。ドメイン層で定義されたリポジトリインターフェースの実装を提供します。

- **役割:** データ永続化（DB 操作）、外部サービス連携、ロギング、セキュリティ、メッセージングなど、システム基盤となる技術的処理
- **例:** データベースへの CRUD 操作、外部決済 API との通信、ファイルシステムへの書き込み

---

### 3. レイヤー間の依存関係

レイヤードアーキテクチャでは、基本的に下位のレイヤーへの依存は許されますが、上位のレイヤーへの依存は許されません。

`プレゼンテーション層` → `アプリケーション層` → `ドメイン層` → `インフラストラクチャ層`

ただし、ドメイン層がインフラストラクチャ層に依存してしまうと、ビジネスロジックが特定の技術実装に縛られてしまいます。これを避けるため、「依存性逆転の原則 (Dependency Inversion Principle)」を適用し、インフラストラクチャ層にドメイン層で定義されたインターフェース（例: リポジトリインターフェース）を実装させることが一般的です。

```
プレゼンテーション層  <-  アプリケーション層  <-  ドメイン層
    ^                                        |
    |                                        v
    ----------------------------------  インフラストラクチャ層
```

---

### 4. レイヤードアーキテクチャのメリット・デメリット

#### メリット

- **高い保守性:** 各レイヤーが独立しているため、変更による影響範囲が限定的です。
- **高いテスト容易性:** 各レイヤーを個別に単体テストしやすいです。
- **明確な役割分担:** 各レイヤーの責任が明確なため、開発者が迷いにくいです。
- **技術的な独立性:** ドメイン層がインフラストラクチャ層から独立しているため、データベースやフレームワークの変更に強いです。
- **拡張性:** 新しい機能を特定のレイヤーに追加しやすいです。

#### デメリット

- **複雑性の増加:** 小規模なシステムではオーバースペックになる可能性があります。
- **レイヤー間の通信オーバーヘッド:** レイヤーをまたがる処理が増えると、性能に影響を与える可能性があります。
- **厳密なルール適用が難しい場合:** 実際の開発で厳密な依存関係を維持するのが難しい場合があります。

---

### 5. まとめ

レイヤードアーキテクチャは、大規模で複雑なシステムを構築する際に非常に有効な設計パターンです。関心事を明確に分離し、保守性、テスト容易性、拡張性を高めることができます。適切なレイヤー設計と依存関係の管理を行うことで、堅牢で持続可能なシステム開発に貢献します。

---
