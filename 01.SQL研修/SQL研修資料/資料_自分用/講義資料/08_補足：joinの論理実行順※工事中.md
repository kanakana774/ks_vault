---
tags:
  - SQL/補足
---
# GROUP BY と集約関数の論理実行イメージ

## 対象 SQL

```SQL
SELECT
	*
FROM
	CUSTOMERS_MST CM
	INNER JOIN ORDERS_TRN OT ON CM.CUSTOMER_ID = OT.CUSTOMER_ID
```

1.from

| "customer_id" | "customer_name" | "email"                         | "created_date" | "deleted_at" |
| ------------- | --------------- | ------------------------------- | -------------- | ------------ |
| 1             | "佐藤 太郎"     | "sato.taro@example.com"         | "2023-01-15"   | null         |
| 2             | "鈴木 花子"     | "suzuki.hanako@example.com"     | "2023-02-20"   | null         |
| 3             | "田中 健太"     | "tanaka.kenta@example.com"      | "2023-03-01"   | null         |
| 4             | "山田 恵美"     | "yamada.emi@example.com"        | "2023-04-10"   | null         |
| 5             | "渡辺 剛"       | "watanabe.takeshi@example.com"  | "2023-05-05"   | null         |
| 6             | "高橋 明"       | "takahashi.akira@example.com"   | "2023-06-12"   | null         |
| 7             | "中村 友子"     | "nakamura.tomoko@example.com"   | "2023-07-25"   | null         |
| 8             | "小林 大輔"     | "kobayashi.daisuke@example.com" | "2023-08-01"   | null         |

2.where

| product_id | category    | product_name          | price    | stock_quantity | memo                                 | deleted_at |
| ---------- | ----------- | --------------------- | -------- | -------------- | ------------------------------------ | ---------- |
| 2          | Electronics | ワイヤレスイヤホン    | 12800.00 | 150            | 高音質でノイズキャンセリング機能付き | null       |
| 3          | Books       | SQL 入門              | 2500.00  | 200            | null                                 | null       |
| 5          | Electronics | スマートウォッチ      | 29800.00 | 100            | 心拍数モニタリング、GPS 搭載         | null       |
| 6          | Books       | Python プログラミング | 3200.00  | 120            | 初心者向けの解説書                   | null       |
| 9          | Electronics | USB 充電器            | 1500.00  | 500            | PD 対応、急速充電可能                | null       |
| 14         | Books       | 自己啓発の法則        | 2500.00  | 250            | 成功へのヒント                       | null       |
| 15         | Electronics | ポータブルバッテリー  | 3980.00  | 220            | 大容量、軽量設計                     | null       |

3.group by

| product_id | category    | product_name                                                           | price                               | stock_quantity     | memo                                                                                                       | deleted_at |
| ---------- | ----------- | ---------------------------------------------------------------------- | ----------------------------------- | ------------------ | ---------------------------------------------------------------------------------------------------------- | ---------- |
| {2,5,9,15} | Electronics | {ワイヤレスイヤホン,スマートウォッチ, USB 充電器,ポータブルバッテリー} | {12800.00,29800.00,1500.00,3980.00} | {150,100,500 ,220} | {高音質でノイズキャンセリング機能付き,心拍数モニタリング、GPS 搭載,PD 対応、急速充電可能,大容量、軽量設計} | null       |
| {3,6,14}   | Books       | {SQL 入門, Python プログラミング, 自己啓発の法則 }                     | {2500.00,3200.00,2500.00}           | {200 ,120, 250}    | {null,初心者向けの解説書,成功へのヒント}                                                                   | null       |

4.having

| product_id | category    | product_name                                                           | price                               | stock_quantity     | memo                                                                                                       | deleted_at |
| ---------- | ----------- | ---------------------------------------------------------------------- | ----------------------------------- | ------------------ | ---------------------------------------------------------------------------------------------------------- | ---------- |
| {2,5,9,15} | Electronics | {ワイヤレスイヤホン,スマートウォッチ, USB 充電器,ポータブルバッテリー} | {12800.00,29800.00,1500.00,3980.00} | {150,100,500 ,220} | {高音質でノイズキャンセリング機能付き,心拍数モニタリング、GPS 搭載,PD 対応、急速充電可能,大容量、軽量設計} | null       |

4.select

| CATEGORY    | PRODUCT_COUNT |
| ----------- | ------------- |
| Electronics | 4             |
