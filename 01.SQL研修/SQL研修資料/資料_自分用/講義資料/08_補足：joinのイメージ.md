---
tags:
  - SQL/è£œè¶³
---
# çµåˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸

## æ¨™æº–çš„ãªçµåˆ


```sql
SELECT
	*
FROM
	orders o
	JOIN orderitems oi ON oi.order_id = o.order_id
```

1.from

orders

| order_id | customer_id | order_date | status    |
| -------- | ----------- | ---------- | --------- |
| 1        | 1           | 2022-01-05 | Shipped   |
| 2        | 2           | 2022-01-10 | Pending   |
| 3        | 1           | 2022-01-15 | Shipped   |
| 4        | 4           | 2022-01-20 | Cancelled |
| 5        | 5           | 2022-01-25 | Shipped   |

orderitems

| order_item_id | order_id | product_id | quantity |
| ------------- | -------- | ---------- | -------- |
| 1             | 1        | 1          | 1        |
| 2             | 1        | 3          | 2        |
| 3             | 2        | 2          | 1        |
| 4             | 3        | 5          | 1        |
| 5             | 4        | 4          | 3        |
| 6             | 5        | 1          | 1        |

2-1.join

orders

| order_id  | customer_id | order_date     | status      |     |
| --------- | ----------- | -------------- | ----------- | --- |
| **==1==** | **1**       | **2022-01-05** | **Shipped** | ğŸ‘ˆ  |
| 2         | 2           | 2022-01-10     | Pending     |     |
| 3         | 1           | 2022-01-15     | Shipped     |     |
| 4         | 4           | 2022-01-20     | Cancelled   |     |
| 5         | 5           | 2022-01-25     | Shipped     |     |

orderitems

| order_item_id | order_id  | product_id | quantity |     |
| ------------- | --------- | ---------- | -------- | --- |
| **1**         | **==1==** | **1**      | **1**    | ğŸ‘ˆ  |
| 2             | 1         | 3          | 2        |     |
| 3             | 2         | 2          | 1        |     |
| 4             | 3         | 5          | 1        |     |
| 5             | 4         | 4          | 3        |     |
| 6             | 5         | 1          | 1        |     |

çµæœã‚»ãƒƒãƒˆ

| order_id | customer_id | order_date | status  | order_item_id | order_id-2 | product_id | quantity |
| -------- | ----------- | ---------- | ------- | ------------- | ---------- | ---------- | -------- |
| ==1==    | 1           | 2022-01-05 | Shipped | 1             | ==1==      | 1          | 1        |

2-2.join

orders

| order_id  | customer_id | order_date     | status      |     |
| --------- | ----------- | -------------- | ----------- | --- |
| **==1==** | **1**       | **2022-01-05** | **Shipped** | ğŸ‘ˆ  |
| 2         | 2           | 2022-01-10     | Pending     |     |
| 3         | 1           | 2022-01-15     | Shipped     |     |
| 4         | 4           | 2022-01-20     | Cancelled   |     |
| 5         | 5           | 2022-01-25     | Shipped     |     |

orderitems

| order_item_id | order_id  | product_id | quantity |     |
| ------------- | --------- | ---------- | -------- | --- |
| 1             | 1         | 1          | 1        |     |
| **2**         | **==1==** | **3**      | **2**    | ğŸ‘ˆ  |
| 3             | 2         | 2          | 1        |     |
| 4             | 3         | 5          | 1        |     |
| 5             | 4         | 4          | 3        |     |
| 6             | 5         | 1          | 1        |     |

çµæœã‚»ãƒƒãƒˆ

| order_id | customer_id | order_date | status  | order_item_id | order_id-2 | product_id | quantity |
| -------- | ----------- | ---------- | ------- | ------------- | ---------- | ---------- | -------- |
| 1        | 1           | 2022-01-05 | Shipped | 1             | 1          | 1          | 1        |
| ==1==    | 1           | 2022-01-05 | Shipped | 2             | ==1==      | 3          | 2        |

2-3.join

ãƒ»ãƒ»ãƒ»

2-30.join
ãƒ»ãƒ»ãƒ»

çµæœã‚»ãƒƒãƒˆ

| order_id | customer_id | order_date | status    | order_item_id | order_id-2 | product_id | quantity |
| -------- | ----------- | ---------- | --------- | ------------- | ---------- | ---------- | -------- |
| 1        | 1           | 2022-01-05 | Shipped   | 1             | 1          | 1          | 1        |
| 1        | 1           | 2022-01-05 | Shipped   | 2             | 1          | 3          | 2        |
| 2        | 2           | 2022-01-10 | Pending   | 3             | 2          | 2          | 1        |
| 3        | 1           | 2022-01-15 | Shipped   | 4             | 3          | 5          | 1        |
| 4        | 4           | 2022-01-20 | Cancelled | 5             | 4          | 4          | 3        |
| 5        | 5           | 2022-01-25 | Shipped   | 6             | 5          | 1          | 1        |

---
## ONå¥ã¯çµåˆæ¡ä»¶ã§ã‚ã£ã¦ã€è¡Œã‚’çµã‚‹å½¹å‰²ã§ã¯ãªã„


```SQL
SELECT
	*
FROM
	orders o
	LEFT JOIN orderitems oi ON TRUE -- ã“ã‚Œã¯å…¨è¡Œçµåˆï¼ˆçµå±€ONå¥ã‚‚booleanã‚’å—ã‘å–ã‚‹
```

```SQL
SELECT
	*
FROM
	orders o
	LEFT JOIN orderitems oi ON oi.order_id = o.order_id
	AND o.order_id = NULL
	-- ã“ã‚Œã¯çµåˆæ¡ä»¶ã‚’æº€ãŸã™è¡Œã¯ç„¡ã•ãã†ã ãŒã€left joinã¯å·¦ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡Œã¯æ®‹ã™ã‚“ã§ã—ãŸã‚ˆã­ã€ã¯ã¦ã•ã¦ãƒ»ãƒ»ãƒ»ï¼Ÿ
```

```sql
SELECT
	*
FROM
	orders o
	JOIN orderitems oi ON oi.order_id = o.order_id
	AND o.order_id = NULL
	-- å†…éƒ¨çµåˆã ã¨ã©ã†ã ã‚ã†ã‹ï¼Ÿ
```

---

## å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒç„¡ã‹ã£ãŸã‚Šã€åˆ—åãŒåŒåã§ãªã‹ã£ãŸã‚Šã€ç›´æ¥çš„ã«é–¢ä¿‚ãŒãªãã¦ã‚‚çµåˆã™ã‚‹ã“ã¨ãŒã‚ã‚‹

### ã‚·ãƒŠãƒªã‚ªï¼šå‹¤å‹™å®Ÿç¸¾ã¨ãã®æ™‚ç‚¹ã§ã®æ­£ã—ã„æ™‚çµ¦ã‚’ç´ä»˜ã‘ã‚‹

å¾“æ¥­å“¡ã®ã€Œå‹¤æ€ å®Ÿç¸¾ã€ã¨ã€æ™‚æœŸã«ã‚ˆã£ã¦å¤‰å‹•ã™ã‚‹ã€Œæ™‚çµ¦ãƒã‚¹ã‚¿ã€ã®2ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
ã‚ã‚‹æ—¥ã®çµ¦ä¸ã‚’è¨ˆç®—ã™ã‚‹ã«ã¯ã€ãã®å¾“æ¥­å“¡ã®ãã®å‹¤å‹™æ—¥æ™‚ç‚¹ã§ã®æ­£ã—ã„æ™‚çµ¦ã‚’é©ç”¨ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

*   **ãƒ†ãƒ¼ãƒ–ãƒ«â‘ : `attendance_logs` (å‹¤æ€ å®Ÿç¸¾)**
    *   èª°ãŒ (`employee_id`)ã€ã„ã¤ (`work_date`)ã€ä½•æ™‚é–“åƒã„ãŸã‹ (`hours_worked`) ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
*   **ãƒ†ãƒ¼ãƒ–ãƒ«â‘¡: `historical_rates` (æ™‚çµ¦ãƒã‚¹ã‚¿)**
    *   å¾“æ¥­å“¡ã”ã¨ã®æ™‚çµ¦ã®å±¥æ­´ã‚’ç®¡ç†ã—ã¾ã™ã€‚å¾“æ¥­å“¡IDã¯ `staff_code` ã¨ã„ã†ç•°ãªã‚‹åˆ—åã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚
    *   åŒã˜å¾“æ¥­å“¡ã§ã‚‚ã€æ˜‡çµ¦ãªã©ã«ã‚ˆã‚Šé©ç”¨æœŸé–“ (`start_date` ã‹ã‚‰ `end_date` ã¾ã§) ã”ã¨ã«ç•°ãªã‚‹æ™‚çµ¦ (`rate`) ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®2ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã«ã¯å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã¯ãªãã€IDã®åˆ—åã‚‚ç•°ãªã‚Šã¾ã™ã€‚å˜ç´”ã«IDã ã‘ã§çµåˆã™ã‚‹ã¨ã€ä¸€äººã®å¾“æ¥­å“¡ã«å¯¾ã—ã¦è¤‡æ•°ã®æ™‚çµ¦ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç´ã¥ã„ã¦ã—ã¾ã„ã€æ­£ã—ã„çµ¦ä¸è¨ˆç®—ãŒã§ãã¾ã›ã‚“ã€‚

**ã€Œå‹¤å‹™æ—¥ (`work_date`) ãŒã€æ™‚çµ¦ã®é©ç”¨æœŸé–“å†… (`start_date` ã¨ `end_date` ã®é–“) ã«ã‚ã‚‹ã€ã¨ã„ã†æ¡ä»¶** ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€åˆã‚ã¦ãã®æ—¥ã®å‹¤å‹™ã«å¯¾ã™ã‚‹æ­£ã—ã„æ™‚çµ¦ã‚’1ã¤ã«ç‰¹å®šã§ãã¾ã™ã€‚

**SQLã‚¯ã‚¨ãƒª:**
`LEFT JOIN` ã‚’ä½¿ç”¨ã—ã€å‹¤æ€ è¨˜éŒ²ã‚’ä¸»è»¸ã«ã€è©²å½“ã™ã‚‹æ™‚çµ¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’çµåˆã—ã¾ã™ã€‚

```sql
WITH
  -- å‹¤æ€ å®Ÿç¸¾ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®šç¾©
  attendance_logs AS (
    SELECT 101 AS employee_id, '2025-10-25' AS work_date, 8 AS hours_worked UNION ALL
    SELECT 101 AS employee_id, '2025-11-10' AS work_date, 8 AS hours_worked UNION ALL -- æ˜‡çµ¦å¾Œã®å‹¤å‹™
    SELECT 202 AS employee_id, '2025-11-15' AS work_date, 7 AS hours_worked
  ),
  -- æœŸé–“ã”ã¨ã«å¤‰å‹•ã™ã‚‹æ™‚çµ¦ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®šç¾©
  historical_rates AS (
    SELECT 101 AS staff_code, 1000 AS rate, '2025-04-01' AS start_date, '2025-10-31' AS end_date UNION ALL -- å¾“æ¥­å“¡101ã®æ—§æ™‚çµ¦
    SELECT 101 AS staff_code, 1100 AS rate, '2025-11-01' AS start_date, '2026-03-31' AS end_date UNION ALL -- å¾“æ¥­å“¡101ã®æ–°æ™‚çµ¦ï¼ˆæ˜‡çµ¦ï¼‰
    SELECT 202 AS staff_code, 1200 AS rate, '2025-04-01' AS start_date, '2026-03-31' AS end_date     -- å¾“æ¥­å“¡202ã®æ™‚çµ¦
  )

-- è¤‡æ•°ã®æ¡ä»¶ï¼ˆIDã®ä¸€è‡´ã¨æœŸé–“å†…åˆ¤å®šï¼‰ã‚’ä½¿ã£ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’çµåˆ
SELECT
  a.employee_id,
  a.work_date,
  a.hours_worked,
  r.rate,
  -- ãã®æ—¥ã®çµ¦ä¸ã‚’è¨ˆç®—
  (a.hours_worked * r.rate) AS daily_wage
FROM
  attendance_logs AS a
LEFT JOIN
  historical_rates AS r ON a.employee_id = r.staff_code -- æ¡ä»¶1: IDãŒä¸€è‡´ã™ã‚‹â‡’å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚‚ãªã‘ã‚Œã°ã€åˆ—åã‚‚ç•°ãªã‚‹
                        AND a.work_date BETWEEN r.start_date AND r.end_date; -- æ¡ä»¶2: å‹¤å‹™æ—¥ãŒæ™‚çµ¦ã®é©ç”¨æœŸé–“å†…ã§ã‚ã‚‹â‡’ç›´æ¥çš„ã«é–¢ä¿‚ãŒãªã„åˆ—åŒå£«
```

**å®Ÿè¡Œçµæœã®ã‚¤ãƒ¡ãƒ¼ã‚¸:**

| employee\_id | work\_date | hours\_worked | rate | daily\_wage |
| :--- | :--- | :--- | :--- | :--- |
| 101 | 2025-10-25 | 8 | 1000 | 8000 |
| 101 | 2025-11-10 | 8 | 1100 | 8800 |
| 202 | 2025-11-15 | 7 | 1200 | 8400 |

**è§£èª¬:**
ã“ã®ã‚¯ã‚¨ãƒªã® `ON` å¥ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

1.  `a.employee_id = r.staff_code`:
    ã¾ãšã€`employee_id` ã¨ `staff_code` ã¨ã„ã†**åå‰ã®ç•°ãªã‚‹åˆ—**ã§å¾“æ¥­å“¡ã‚’ç´ä»˜ã‘ã¾ã™ã€‚
2.  `AND a.work_date BETWEEN r.start_date AND r.end_date`:
    æ¬¡ã«ã€å˜ç´”ãªIDã®ä¸€è‡´ã«åŠ ãˆã¦ã€**ã€Œå‹¤æ€ æ—¥ã€ãŒã€Œæ™‚çµ¦ã®é©ç”¨æœŸé–“ã€ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹**ã¨ã„ã†ç¯„å›²æ¡ä»¶ã§çµã‚Šè¾¼ã¿ã¾ã™ã€‚

ã“ã®2ã¤ã®æ¡ä»¶ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€å¾“æ¥­å“¡ID `101` ã®å‹¤å‹™è¨˜éŒ²ã«å¯¾ã—ã¦ã€è¤‡æ•°ã®æ™‚çµ¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸­ã‹ã‚‰**ãã®æ—¥æ™‚ç‚¹ã§ã®æ­£ã—ã„æ™‚çµ¦**ã‚’ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆã§çµåˆã§ãã¾ã™ã€‚

*   `2025-10-25` ã®å‹¤å‹™ã¯ã€é©ç”¨æœŸé–“ `2025-04-01`ï½`2025-10-31` ã®æ™‚çµ¦ `1000` å††ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«çµåˆã•ã‚Œã¾ã™ã€‚
*   `2025-11-10` ã®å‹¤å‹™ã¯ã€é©ç”¨æœŸé–“ `2025-11-01`ï½`2026-03-31` ã®æ™‚çµ¦ `1100` å††ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«çµåˆã•ã‚Œã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€è¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæŒã¤æƒ…å ±ï¼ˆã“ã®ä¾‹ã§ã¯IDã¨æ™‚é–“ï¼‰ã‚’çµ„ã¿åˆã‚ã›ãŸè¤‡é›‘ãªæ¡ä»¶ã‚’ `ON` å¥ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã€çŸ­çµ¡çš„ãªçµåˆã§ã¯å¾—ã‚‰ã‚Œãªã„ã€ãƒ“ã‚¸ãƒã‚¹ä¸Šæ„å‘³ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å°ãå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€Œéç­‰ä¾¡çµåˆï¼ˆNon-Equi Joinï¼‰ã€ã¨å‘¼ã°ã‚Œã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®ä¸€ä¾‹ã§ã™ã€‚